<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… ÙˆØ±Ø´ Ø§Ù„Ø°ÙƒÙŠ | ØªØ·ÙˆÙŠØ± Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        :root { --p: #003366; --g: #00ffcc; --bg: #000b18; --card: #001a33; --txt: #e0f2f1; }
        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; transition: 0.3s; }
        body { background: var(--bg); color: var(--txt); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .card { background: var(--card); border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 100%; max-width: 700px; border: 1px solid rgba(0,255,204,0.1); margin: 10px 0; }
        .mustafa-tag { color: var(--g); font-weight: bold; font-size: 13px; text-align: center; display: block; margin: 10px 0; text-shadow: 0 0 10px var(--g); }
        .btn { padding: 14px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%; margin: 5px 0; font-size: 15px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-tech { background: linear-gradient(90deg, #003366, #00509d); color: white; border: 1px solid var(--g); }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #1a3a5a; background: #00254d; color: white; outline: none; }
        .hidden { display: none !important; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
        .grid-item { background: #00254d; padding: 15px; border-radius: 12px; text-align: center; border: 1px solid #004080; cursor: pointer; font-size: 13px; position: relative; }
        .history-item { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; margin-bottom: 10px; border-right: 4px solid var(--g); }
        .delay-alert { background: rgba(255, 82, 82, 0.1); border: 1px solid #ff5252; color: #ff5252; padding: 15px; border-radius: 15px; font-size: 13px; margin-bottom: 15px; }
        .progress-box { background: linear-gradient(135deg, #001a33, #003366); padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px; border: 1px solid var(--g); }
        .progress-val { font-size: 32px; font-weight: bold; color: var(--g); }
        footer { margin-top: auto; text-align: center; font-size: 11px; padding: 20px; color: #666; width: 100%; }
        .admin-controls { display: flex; gap: 5px; margin-top: 10px; }
    </style>
</head>
<body>

<div id="loginGate" class="card">
    <div class="mustafa-tag">ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± ÙˆØ§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡</div>
    <h2 style="text-align:center;">Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¥Ù…Ø§Ù… ÙˆØ±Ø´ Ø§Ù„Ø°ÙƒÙŠØ© ğŸ›¡ï¸</h2>
    <input type="text" id="entryKey" placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    <input type="password" id="entryPass" class="hidden" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button class="btn btn-tech" onclick="mainAuth()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
    <button class="btn" style="background:transparent; color:var(--g); font-size:12px;" onclick="showStaffInputs()">Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙƒØ§Ø¯Ø± Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</button>
</div>

<div id="app" class="hidden" style="width:100%; max-width:700px;">
    
    <div id="studentPage" class="hidden card">
        <div class="mustafa-tag">Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ±: Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡</div>
        <h3 id="welcomeMsg"></h3>
        
        <div class="progress-box">
            <small>Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</small>
            <div class="progress-val" id="weekProgress">0 / 0</div>
        </div>

        <div id="delayBox" class="delay-alert hidden">
            <b>âš ï¸ Ø¯Ø±ÙˆØ³ Ù…ØªØ£Ø®Ø±Ø© ÙŠØ¬Ø¨ ØªØ³Ù…ÙŠØ¹Ù‡Ø§:</b>
            <div id="delayList" style="margin-top:8px; font-size:11px;"></div>
        </div>
        
        <div style="display:flex; gap:5px; margin-bottom:15px;">
            <button class="btn btn-tech" onclick="toggleTopTen()">ğŸ† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙˆØ§Ø¦Ù„</button>
            <button class="btn btn-tech" onclick="showScreen('termsPage')">ğŸ“– Ø´Ø±Ø­ Ø§Ù„Ù…ØµØ·Ù„Ø­Ø§Øª</button>
        </div>
        <div id="topTenList" class="hidden" style="background:#00254d; padding:15px; border-radius:12px; margin-bottom:15px;"></div>

        <h4>Ø³Ø¬Ù„ Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ:</h4>
        <div id="recordsList" style="max-height:400px; overflow-y:auto;"></div>
        <button class="btn" onclick="logout()" style="background:#cc0000; color:white; margin-top:15px;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="teacherDash" class="hidden card">
        <div class="mustafa-tag">ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø³ØªØ§Ø° Ø³Ø¹Ø¯ Ø§Ù„Ù…Ø·Ù„Ù‚ - ØªØ·ÙˆÙŠØ± Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡</div>
        
        <div style="background:rgba(0,255,204,0.05); padding:15px; border-radius:12px; margin-bottom:15px;">
            <label>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù‚Ø±Ø± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ (Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙˆØ¬Ù‡):</label>
            <div style="display:flex; gap:10px;">
                <input type="number" id="targetPages" placeholder="Ù…Ø«Ù„Ø§Ù‹: 5" style="margin:0;">
                <button class="btn btn-tech" onclick="setGlobalTarget()" style="width:100px; margin:0;">Ø­ÙØ¸</button>
            </div>
        </div>

        <input type="text" id="searchBox" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨..." oninput="filterStudents()">
        <div style="display:flex; gap:10px; margin:10px 0;">
            <button class="btn btn-tech" onclick="loadClass('3/1')">ÙØµÙ„ 3/1</button>
            <button class="btn btn-tech" onclick="loadClass('3/2')">ÙØµÙ„ 3/2</button>
        </div>
        <div id="namesGrid" class="grid"></div>
        
        <hr style="border:0; border-top:1px solid #1a3a5a; margin:20px 0;">
        <button class="btn btn-tech" onclick="showManageStudents()">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù†Ø¸Ø§Ù…</button>
        <button class="btn btn-tech" onclick="logout()">Ø®Ø±ÙˆØ¬ Ø¢Ù…Ù†</button>
    </div>

    <div id="gradeScreen" class="hidden card">
        <h3 id="targetName"></h3>
        <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:10px; margin-bottom:15px;">
            <label style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                <input type="checkbox" id="isLate" style="width:20px;"> Ø±ØµØ¯ ÙƒÙ€ "Ø¯ÙØ±Ø³ Ù…ÙØªØ£Ø®Ø±" (Ù„Ø§ ÙŠØ­Ø³Ø¨ ÙÙŠ Ø§Ù„Ø¹Ø¯Ø§Ø¯)
            </label>
        </div>
        <select id="gWeek"></select>
        <select id="gDay"><option>Ø§Ù„Ø£Ø­Ø¯</option><option>Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</option><option>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option><option>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option><option>Ø§Ù„Ø®Ù…ÙŠØ³</option></select>
        <input type="number" id="gPage" placeholder="Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø©">
        <input type="number" id="gMark" max="7" placeholder="Ø§Ù„Ø¯Ø±Ø¬Ø© Ù…Ù† 7">
        <select id="gStatus">
            <option value="Ø­Ø§ÙØ¸">Ø­Ø§ÙØ¸ âœ…</option>
            <option value="ØºÙŠØ± Ø­Ø§ÙØ¸">ØºÙŠØ± Ø­Ø§ÙØ¸ âš ï¸</option>
            <option value="Ù„Ù… ÙŠØ³Ù…Ø¹">Ù„Ù… ÙŠØ³Ù…Ø¹ âŒ</option>
            <option value="Ù…Ø­Ø±ÙˆÙ…">Ù…Ø­Ø±ÙˆÙ… ğŸš«</option>
            <option value="ØºØ§Ø¦Ø¨">ØºØ§Ø¦Ø¨ ğŸ’¤</option>
        </select>
        <textarea id="gNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø£Ø³ØªØ§Ø° Ù„ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±"></textarea>
        <button class="btn btn-tech" onclick="saveGrade()">Ø±ØµØ¯ / ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø±Ø¬Ø©</button>
        <div id="editHistory" style="margin-top:15px;"></div>
        <button class="btn" onclick="showScreen('teacherDash')">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>

    <div id="manageStudentsPage" class="hidden card">
        <h3>Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
        <div id="addForm" style="border-bottom:1px solid #444; padding-bottom:15px; margin-bottom:15px;">
            <input type="text" id="newSName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
            <input type="text" id="newSCode" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø§Ù„Ù…ÙØªØ§Ø­)">
            <select id="newSClass"><option value="3/1">3/1</option><option value="3/2">3/2</option></select>
            <button class="btn btn-tech" onclick="addNewStudent()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø·Ø§Ù„Ø¨</button>
        </div>
        <div id="fullStudentList" style="max-height:300px; overflow-y:auto;"></div>
        <button class="btn" onclick="showScreen('teacherDash')">Ø±Ø¬ÙˆØ¹</button>
    </div>
</div>

<footer>
    <b>Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ±: Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø£Ø­Ù…Ø¯ | 0599804296</b><br>
    Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ø£ÙÙƒØ§Ø±: ÙŠØ²Ù† Ø£Ù†Ø³ ÙˆÙ…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ
</footer>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAC9BzBpw66oBDriZoi9A5zsThKLFZiNv8", databaseURL: "https://imam-warsh-default-rtdb.asia-southeast1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let students = []; let currentSID = null; let globalTarget = 0;

    const weeks = ["Ø§Ù„Ø£ÙˆÙ„","Ø§Ù„Ø«Ø§Ù†ÙŠ","Ø§Ù„Ø«Ø§Ù„Ø«","Ø§Ù„Ø±Ø§Ø¨Ø¹","Ø§Ù„Ø®Ø§Ù…Ø³","Ø§Ù„Ø³Ø§Ø¯Ø³","Ø§Ù„Ø³Ø§Ø¨Ø¹","Ø§Ù„Ø«Ø§Ù…Ù†","Ø§Ù„ØªØ§Ø³Ø¹","Ø§Ù„Ø¹Ø§Ø´Ø±","Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±","Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±","Ø§Ù„Ø«Ø§Ù„Ø« Ø¹Ø´Ø±","Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø¹Ø´Ø±","Ø§Ù„Ø®Ø§Ù…Ø³ Ø¹Ø´Ø±","Ø§Ù„Ø³Ø§Ø¯Ø³ Ø¹Ø´Ø±","Ø§Ù„Ø³Ø§Ø¨Ø¹ Ø¹Ø´Ø±","Ø§Ù„Ø«Ø§Ù…Ù† Ø¹Ø´Ø±","Ø§Ù„ØªØ§Ø³Ø¹ Ø¹Ø´Ø±","Ø§Ù„Ø¹Ø´Ø±ÙˆÙ†","Ø§Ù„Ø­Ø§Ø¯ÙŠ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†","Ø§Ù„Ø«Ø§Ù†ÙŠ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†","Ø§Ù„Ø«Ø§Ù„Ø« ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†","Ø§Ù„Ø±Ø§Ø¨Ø¹ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†","Ø§Ù„Ø®Ø§Ù…Ø³ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†","Ø§Ù„Ø³Ø§Ø¯Ø³ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†","Ø§Ù„Ø³Ø§Ø¨Ø¹ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†","Ø§Ù„Ø«Ø§Ù…Ù† ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†","Ø§Ù„ØªØ§Ø³Ø¹ ÙˆØ§Ù„Ø¹Ø´Ø±ÙˆÙ†","Ø§Ù„Ø«Ù„Ø§Ø«ÙˆÙ†"];
    document.getElementById('gWeek').innerHTML = weeks.map(w => `<option value="Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${w}">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${w}</option>`).join('');

    // Ø¬Ù„Ø¨ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ
    db.ref('settings/target').on('value', s => { globalTarget = s.val() || 0; });

    function showStaffInputs() { document.getElementById('entryPass').classList.remove('hidden'); }

    function mainAuth() {
        const user = document.getElementById('entryKey').value.trim();
        const pass = document.getElementById('entryPass').value.trim();
        db.ref('students').once('value', snap => {
            students = snap.exists() ? Object.values(snap.val()) : [];
            if(user === 'saad' && pass === 'saad2026') { unlockApp('teacherDash'); }
            else if(user === 'admin' && pass === 'admin2026') { unlockApp('adminDash'); }
            else {
                const s = students.find(x => x.code === user);
                if(s) { currentSID = s.id; unlockApp('studentPage'); renderStudentPage(s); }
                else alert('Ø§Ù„Ù…ÙØªØ§Ø­ ØºÙŠØ± ØµØ­ÙŠØ­');
            }
        });
    }

    function renderStudentPage(s) {
        document.getElementById('welcomeMsg').innerHTML = `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ: <b>${s.name}</b> ğŸŒŸ`;
        const recs = s.records || [];
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø¯Ø§Ø¯ (Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©)
        const currentWeek = recs.length > 0 ? recs[recs.length-1].week : "Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„";
        const weekDone = recs.filter(r => r.week === currentWeek && r.status === 'Ø­Ø§ÙØ¸' && !r.isLate).length;
        document.getElementById('weekProgress').innerText = `${weekDone} / ${globalTarget}`;

        // Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©
        const delays = recs.filter(r => ['ØºÙŠØ± Ø­Ø§ÙØ¸','Ù…Ø­Ø±ÙˆÙ…','Ù„Ù… ÙŠØ³Ù…Ø¹'].includes(r.status));
        if(delays.length > 0) {
            document.getElementById('delayBox').classList.remove('hidden');
            document.getElementById('delayList').innerHTML = delays.map(d => `â€¢ ${d.week} (${d.day}) - ØµÙØ­Ø©: ${d.page} [${d.status}]`).join('<br>');
        }

        document.getElementById('recordsList').innerHTML = recs.map(r => `
            <div class="history-item" style="border-right-color: ${r.isLate ? '#ff9800' : '#00ffcc'}">
                <div style="display:flex; justify-content:space-between">
                    <b>${r.week} - ${r.day} ${r.isLate ? '(Ø¯ÙØ±Ø³ Ù…ÙØªØ£Ø®Ø±)' : ''}</b> 
                    <span>${r.mark}/7</span>
                </div>
                <small>Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø©: ${r.page}</small> | <b>Ø§Ù„Ø­Ø§Ù„Ø©: ${r.status}</b>
                ${r.prevStatus ? `<div style="color:#ffcc00; font-size:11px;">(ØªÙ… Ø§Ù„ØªØ³Ù…ÙŠØ¹ - Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©: ${r.prevStatus})</div>` : ''}
                <div style="font-size:11px; color:#aaa;">${r.note || ''}</div>
            </div>
        `).reverse().join('');
    }

    function saveGrade() {
        const s = students.find(x => x.id == currentSID);
        const week = document.getElementById('gWeek').value;
        const page = document.getElementById('gPage').value;
        const status = document.getElementById('gStatus').value;
        const isLate = document.getElementById('isLate').checked;

        if(!s.records) s.records = [];
        const idx = s.records.findIndex(r => r.week === week && r.page === page);
        let oldSt = null;
        if(idx !== -1) { oldSt = s.records[idx].status; s.records.splice(idx, 1); }

        s.records.push({
            week, day: document.getElementById('gDay').value, page, mark: document.getElementById('gMark').value,
            status, note: document.getElementById('gNote').value, isLate,
            prevStatus: (status === 'Ø­Ø§ÙØ¸' && oldSt) ? oldSt : (idx !== -1 ? s.records[idx]?.prevStatus : null)
        });

        db.ref('students/'+currentSID+'/records').set(s.records).then(() => { alert('ØªÙ… Ø§Ù„Ø±ØµØ¯'); showScreen('teacherDash'); });
    }

    function setGlobalTarget() {
        const val = document.getElementById('targetPages').value;
        db.ref('settings/target').set(val).then(() => alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‚Ø±Ø± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ'));
    }

    function showManageStudents() {
        showScreen('manageStudentsPage');
        const list = document.getElementById('fullStudentList');
        list.innerHTML = students.map(s => `
            <div style="padding:10px; border-bottom:1px solid #222; display:flex; justify-content:space-between; align-items:center;">
                <div style="font-size:12px;"><b>${s.name}</b><br><small>Ø§Ù„Ù…ÙØªØ§Ø­: ${s.code} | ÙØµÙ„: ${s.class}</small></div>
                <div class="admin-controls">
                    <button onclick="deleteStudent('${s.id}')" style="background:red; color:white; border:none; padding:5px; border-radius:5px;">Ø­Ø°Ù</button>
                </div>
            </div>
        `).join('');
    }

    function addNewStudent() {
        const id = Date.now();
        const name = document.getElementById('newSName').value;
        const code = document.getElementById('newSCode').value;
        const cls = document.getElementById('newSClass').value;
        if(name && code) db.ref('students/'+id).set({ id, name, code, class: cls }).then(() => { alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©'); location.reload(); });
    }

    function deleteStudent(id) { if(confirm('Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ³Ø¬Ù„Ø§ØªÙ‡ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŒ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) db.ref('students/'+id).remove().then(() => location.reload()); }
    function loadClass(cls) {
        const grid = document.getElementById('namesGrid'); grid.innerHTML = "";
        students.filter(x => x.class === cls).forEach(s => {
            const div = document.createElement('div'); div.className = "grid-item";
            div.innerHTML = `${s.name} <br> <small style="font-size:9px; color:var(--g)">${s.code}</small>`;
            div.onclick = () => { currentSID = s.id; document.getElementById('targetName').innerText = s.name; renderEditHistory(s); showScreen('gradeScreen'); };
            grid.appendChild(div);
        });
    }
    // Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© (ØªØµÙÙŠØ©ØŒ ØªÙ†Ù‚Ù„ØŒ Ø®Ø±ÙˆØ¬) Ù†ÙØ³ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø±.
    function unlockApp(s) { document.getElementById('loginGate').classList.add('hidden'); document.getElementById('app').classList.remove('hidden'); showScreen(s); }
    function showScreen(id) { document.querySelectorAll('#app > div').forEach(d => d.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
    function logout() { location.reload(); }
    function filterStudents() {
        const q = document.getElementById('searchBox').value.toLowerCase();
        document.querySelectorAll('.grid-item').forEach(it => it.style.display = it.innerText.toLowerCase().includes(q) ? 'block' : 'none');
    }
    function renderEditHistory(s) {
        document.getElementById('editHistory').innerHTML = "<b>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:</b>" + (s.records || []).map((r, i) => `
            <div style="font-size:11px; padding:5px; border-bottom:1px solid #444; display:flex; justify-content:space-between">
                <span>${r.week} | Øµ ${r.page} | ${r.status}</span>
                <button onclick="deleteRecord(${i})" style="color:red; background:none; border:none; cursor:pointer">Ø­Ø°Ù</button>
            </div>
        `).join('');
    }
    function deleteRecord(i) {
        if(confirm('Ø­Ø°Ù Ø§Ù„Ø¯Ø±Ø¬Ø©ØŸ')) {
            const s = students.find(x => x.id == currentSID);
            s.records.splice(i, 1);
            db.ref('students/'+currentSID+'/records').set(s.records).then(() => renderEditHistory(s));
        }
    }
</script>
</body>
</html>
