<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ูุฏุฑุณุฉ ุงูุฅูุงู ูุฑุด ุงูุฐูู | ุชุทููุฑ ูุตุทูู ุนุจุฏ ุงููู ุฃุญูุฏ</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script> (function() { emailjs.init("arHaHSMk0C-C01YHE"); })(); </script>
    <style>
        :root { --bg: #f4f7f6; --card: #ffffff; --p: #2c3e50; --g: #27ae60; --txt: #2c3e50; --red: #e74c3c; --orange: #f39c12; --blue: #3498db; --yellow: #f1c40f; }
        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; transition: 0.3s; }
        body { background: var(--bg); color: var(--txt); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .card { background: var(--card); border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 700px; margin: 10px 0; position: relative; border: 1px solid rgba(0,0,0,0.05); }
        .mustafa-tag { color: var(--g); font-weight: bold; font-size: 13px; text-align: center; display: block; margin: 10px 0; }
        .btn { padding: 14px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%; margin: 5px 0; font-size: 15px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-tech { background: var(--g); color: white; }
        .btn-back { background: rgba(0,0,0,0.1); color: var(--txt); width: auto; padding: 5px 15px; font-size: 12px; position: absolute; top: 10px; right: 10px; z-index: 100; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #ddd; background: white; font-size: 14px; }
        .hidden { display: none !important; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-top: 15px; }
        .grid-item { background: var(--card); padding: 15px; border-radius: 12px; text-align: center; border: 2px solid var(--g); cursor: pointer; font-weight: bold; }
        .history-item { background: rgba(0,0,0,0.03); padding: 15px; border-radius: 15px; margin-bottom: 10px; border-right: 5px solid var(--g); position: relative; text-align: right; }
        .modified-badge { background: var(--yellow); color: #000; padding: 2px 8px; border-radius: 5px; font-size: 11px; font-weight: bold; margin-top: 5px; display: inline-block; }
        .modified-card { border: 2px solid var(--yellow) !important; background: #fffde7; }
        .top-rank { background: linear-gradient(135deg, #f1c40f, #f39c12); color: white; padding: 15px; border-radius: 15px; margin-bottom: 20px; }
        footer { margin-top: auto; padding: 20px; font-size: 12px; color: #777; text-align: center; }
        .terms-box { background: #fff9e6; border: 1px solid #f1c40f; padding: 15px; border-radius: 15px; margin-top: 20px; font-size: 13px; line-height: 1.6; }
        .alert-info { background: #e3f2fd; border-right: 5px solid var(--blue); padding: 10px; border-radius: 10px; font-size: 13px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div id="loginGate" class="card">
    <div class="mustafa-tag">| ูุธุงู ูุฏุฑุณุฉ ุงูุฅูุงู ูุฑุด ุงูุฐูู |</div>
    <h2 style="text-align:center;">ุชุณุฌูู ุงูุฏุฎูู ๐ก๏ธ</h2>
    <input type="text" id="entryKey" placeholder="ุฃุฏุฎู ุงูููุฏ (ููุทุงูุจ) ุฃู ุงุณู ุงููุณุชุฎุฏู">
    <div id="staffSection" class="hidden">
        <input type="password" id="entryPass" placeholder="ูููุฉ ุงููุฑูุฑ">
    </div>
    <button class="btn btn-tech" onclick="mainAuth()">ุฏุฎูู ุงููุธุงู</button>
    <button class="btn" style="background:transparent; color:var(--g);" onclick="document.getElementById('staffSection').classList.toggle('hidden')">ุฏุฎูู ุงููุงุฏุฑ ุงูุฅุฏุงุฑู</button>
</div>

<div id="otpGate" class="card hidden">
    <h2 style="text-align:center;">ุชุญูู ุงูุฃูุงู ๐</h2>
    <p style="text-align:center; font-size:14px;">ุชู ุฅุฑุณุงู ุฑูุฒ ุงูุชุญูู ุฅูู ุฅูููู ุงูุฃุณุชุงุฐ ุณุนุฏ ูุฅูููู ุงููุทูุฑ.</p>
    <input type="number" id="otpInput" placeholder="ุฃุฏุฎู ุฑูุฒ ุงูุชุญูู ุงููููู ูู 6 ุฃุฑูุงู">
    <button class="btn btn-tech" onclick="verifyOTP()">ุชุฃููุฏ ุงูุฑูุฒ ูุงูุฏุฎูู</button>
    <button class="btn" onclick="location.reload()">ุฅูุบุงุก</button>
</div>

<div id="app" class="hidden" style="width:100%; max-width:700px;">
    <div id="topTenSection" class="card top-rank">
        <h3 style="margin:0; text-align:center;">๐ ุงูุนุดุฑุฉ ุงูุฃูุงุฆู ููุฐุง ุงูุฃุณุจูุน</h3>
        <div id="topList" style="margin-top:10px; font-weight:bold; text-align:center;"></div>
    </div>

    <div id="studentPage" class="hidden card">
        <button class="btn btn-back" onclick="location.reload()">ุฎุฑูุฌ</button>
        <h3 id="welcomeMsg"></h3>
        <div class="alert-info">
            <b>ุชูููู:</b> ููููู ุฅุนุงุฏุฉ ุชุณููุน ุฃู ุฏุฑุณ (ูููุง ูุงูุช ุญุงูุฉ ุงูุฏุฑุณ) ูุฐูู ุจุงูุชุฑุชูุจ ูุน ุงูุฃุณุชุงุฐ.
        </div>
        <h4>ุณุฌูู ุงูุฏุฑุงุณู:</h4>
        <div id="recordsList"></div>
        <div class="terms-box">
            <h4 style="margin-top:0;">๐ ุดุฑุญ ุงููุตุทูุญุงุช:</h4>
            <b>โ ูู ูุณูุน:</b> ูู ุชุญูุธ ุงูุฏุฑุณ ุฅุทูุงูุงู.<br>
            <b>โ๏ธ ุบูุฑ ุญุงูุธ:</b> ุณูุนุช ูููู ูุฏูู ุฃุฎุทุงุก ููุนุชู ูู ุงูุงุฌุชูุงุฒ.<br>
            <b>โ ุญุงูุธ:</b> ุณูุนุช ุงูุฏุฑุณ ุจูุฌุงุญ.<br>
            <b>๐ซ ูุญุฑูู:</b> ุนููุจุฉ ุฅุฏุงุฑูุฉ ููุฎุงููุฉ ุงูููุงููู ุชุคุฏู ููุญุฑูุงู ูู ุงูุฏุฑุณ.<br>
            <b>๐ค ุบุงุฆุจ:</b> ูู ุชุญุถุฑ ุงูุญุตุฉ.
        </div>
    </div>

    <div id="teacherDash" class="hidden card">
        <button class="btn btn-back" onclick="location.reload()">ุฎุฑูุฌ</button>
        <div id="roleDisplay" class="mustafa-tag"></div>
        <button class="btn" style="background:var(--blue); color:white; font-size:12px;" onclick="showScreen('guidePage')">๐ ุดุฑุญ ุงุณุชุฎุฏุงู ุงููููุน</button>
        <input type="text" id="searchBox" placeholder="๐ ุจุญุซ ุนู ุงุณู ุทุงูุจ..." oninput="filterGrid()">
        <div id="classTabs" style="display:flex; gap:10px; margin:10px 0; flex-wrap: wrap;"></div>
        <div id="namesGrid" class="grid"></div>
        <button id="adminBtn" class="btn hidden" style="background:#2c3e50; color:white; margin-top:20px;" onclick="showManagePage()">โ๏ธ ููุญุฉ ุงูุฅุฏุงุฑุฉ ูุงูุตูุงูุฉ</button>
    </div>

    <div id="gradeScreen" class="hidden card">
        <button class="btn btn-back" onclick="showScreen('teacherDash')">ุฑุฌูุน ูููุงุฆูุฉ</button>
        <h3 id="targetName" style="color:var(--g)"></h3>
        <div id="gradeForm">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <select id="gWeek"></select>
                <select id="gDay">
                    <option value="ููู ุงูุฃุญุฏ">ููู ุงูุฃุญุฏ</option><option value="ููู ุงูุงุซููู">ููู ุงูุงุซููู</option><option value="ููู ุงูุซูุงุซุงุก">ููู ุงูุซูุงุซุงุก</option><option value="ููู ุงูุฃุฑุจุนุงุก">ููู ุงูุฃุฑุจุนุงุก</option><option value="ููู ุงูุฎููุณ">ููู ุงูุฎููุณ</option>
                </select>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <input type="number" id="gPage" placeholder="ุฑูู ุงูุตูุญุฉ">
                <input type="number" id="gMark" placeholder="ุงูุฏุฑุฌุฉ / 7">
            </div>
            <select id="gStatus">
                <option value="ุญุงูุธ">ุญุงูุธ โ</option>
                <option value="ุบูุฑ ุญุงูุธ">ุบูุฑ ุญุงูุธ โ๏ธ</option>
                <option value="ูู ูุณูุน">ูู ูุณูุน โ</option>
                <option value="ูุญุฑูู">ูุญุฑูู ๐ซ</option>
                <option value="ุบุงุฆุจ">ุบุงุฆุจ ๐ค</option>
            </select>
            <textarea id="gNote" placeholder="ุงูุชุจ ููุงุญุธุฉ ููุทุงูุจ ููุง..."></textarea>
            <button class="btn btn-tech" id="saveBtn" onclick="saveGrade()">ุญูุธ ุงูุจูุงูุงุช</button>
        </div>
        <hr>
        <h4>ุงูุณุฌู ุงูุฏุฑุงุณู (ุงุถุบุท ููุชุนุฏูู):</h4>
        <div id="editHistory"></div>
    </div>

    <div id="guidePage" class="hidden card">
        <button class="btn btn-back" onclick="showScreen('teacherDash')">ุฑุฌูุน</button>
        <h3>๐ ุฏููู ุงููุฏุฑุณูู</h3>
        <p>1. <b>ุชุนุฏูู ุงูุฏุฑุฌุงุช:</b> ููููู ุชุนุฏูู ุฃู ุณุฌู ูุฏูู. ุนูุฏ ุงูุชุนุฏููุ ุณูุธูุฑ ุฃุตู ุงูุญุงูุฉ ุงููุฏููุฉ ุจุฌุงูุจ ุงูุฏุฑุฌุฉ ุงูุฌุฏูุฏุฉ ุชููุงุฆูุงู.</p>
        <p>2. <b>ููู ุงูุทุงูุจ:</b> ูุชู ูู ููุญุฉ ุงูุฅุฏุงุฑุฉุ ููููู ุงูุทุงูุจ ุจูุงูู ุชุงุฑูุฎู ูููุงุญุธุงุชู.</p>
    </div>

    <div id="managePage" class="hidden card">
        <button class="btn btn-back" onclick="showScreen('teacherDash')">ุฑุฌูุน</button>
        <h3>ุฅุฏุงุฑุฉ ุงููุธุงู</h3>
        <button class="btn" style="background:var(--red); color:white;" onclick="resetTopTen()">๐งน ุชุญุฏูุซ ุงูุนุดุฑุฉ ุงูุฃูุงุฆู</button>
        <hr>
        <h4>โ ุฅุถุงูุฉ ูุตูู ููุนูููู:</h4>
        <input type="text" id="newClassName" placeholder="ุงุณู ุงููุตู ุงูุฌุฏูุฏ">
        <button class="btn btn-tech" onclick="addNewClass()">ุฅุถุงูุฉ ูุตู</button>
        <div style="background:#eee; padding:10px; border-radius:10px; margin-top:10px;">
            <input type="text" id="tUser" placeholder="ููุฒุฑ ุงููุนูู">
            <input type="text" id="tPass" placeholder="ุจุงุณูุฑุฏ ุงููุนูู">
            <select id="tClassAssign"></select>
            <label><input type="checkbox" id="makeOwner"> ููุญู ุตูุงุญูุงุช ุงูุฅุฏุงุฑุฉ</label>
            <button class="btn btn-tech" onclick="addNewTeacher()">ุญูุธ ุงููุนูู</button>
        </div>
        <hr>
        <h4>๐ ุฅุฏุงุฑุฉ ุงูุทูุงุจ:</h4>
        <input type="text" id="newSName" placeholder="ุงุณู ุงูุทุงูุจ">
        <input type="text" id="newSCode" placeholder="ููุฏ ุงูุทุงูุจ">
        <select id="newSClass"></select>
        <button class="btn btn-tech" onclick="addNewStudent()">ุฅุถุงูุฉ ุทุงูุจ</button>
        <hr>
        <div id="fullList"></div>
    </div>
</div>

<footer><b>ุชุทููุฑ: ูุตุทูู ุนุจุฏ ุงููู ุฃุญูุฏ | 0599804296</b></footer>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAC9BzBpw66oBDriZoi9A5zsThKLFZiNv8", databaseURL: "https://imam-warsh-default-rtdb.asia-southeast1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let students = []; let classes = ["3/1", "3/2"]; let teachers = [];
    let currentSID = null; let currentUser = null; let generatedOTP = null;

    const weeksArr = ["ุงูุฃูู","ุงูุซุงูู","ุงูุซุงูุซ","ุงูุฑุงุจุน","ุงูุฎุงูุณ","ุงูุณุงุฏุณ","ุงูุณุงุจุน","ุงูุซุงูู","ุงูุชุงุณุน","ุงูุนุงุดุฑ","ุงูุฃุญุฏ ุนุดุฑ","ุงูุซุงูู ุนุดุฑ","ุงูุซุงูุซ ุนุดุฑ","ุงูุฑุงุจุน ุนุดุฑ","ุงูุฎุงูุณ ุนุดุฑ","ุงูุณุงุฏุณ ุนุดุฑ","ุงูุณุงุจุน ุนุดุฑ","ุงูุซุงูู ุนุดุฑ","ุงูุชุงุณุน ุนุดุฑ","ุงูุนุดุฑูู","ุงูุญุงุฏู ูุงูุนุดุฑูู","ุงูุซุงูู ูุงูุนุดุฑูู","ุงูุซุงูุซ ูุงูุนุดุฑูู","ุงูุฑุงุจุน ูุงูุนุดุฑูู","ุงูุฎุงูุณ ูุงูุนุดุฑูู","ุงูุณุงุฏุณ ูุงูุนุดุฑูู","ุงูุณุงุจุน ูุงูุนุดุฑูู","ุงูุซุงูู ูุงูุนุดุฑูู","ุงูุชุงุณุน ูุงูุนุดุฑูู","ุงูุซูุงุซูู"];
    document.getElementById('gWeek').innerHTML = weeksArr.map(w => `<option value="ุงูุฃุณุจูุน ${w}">ุงูุฃุณุจูุน ${w}</option>`).join('');

    function fetchAllData() {
        db.ref('classes').on('value', s => { if(s.val()) classes = Object.values(s.val()); updateSelectors(); });
        db.ref('teachers').on('value', s => { teachers = s.val() ? Object.values(s.val()) : []; });
        db.ref('students').on('value', snap => {
            const data = snap.val();
            students = data ? Object.entries(data).map(([id, val]) => ({...val, id: id})) : [];
            if(currentSID) {
                const updated = students.find(x => x.id === currentSID);
                if(updated) renderEditHistory(updated);
            }
        });
        db.ref('topTen').on('value', sn => { document.getElementById('topList').innerHTML = (sn.val() || []).join(' | '); });
    }
    fetchAllData();

    function updateSelectors() {
        const options = classes.map(c => `<option value="${c}">${c}</option>`).join('');
        document.getElementById('tClassAssign').innerHTML = options;
        document.getElementById('newSClass').innerHTML = options;
    }

    async function mainAuth() {
        const key = document.getElementById('entryKey').value.trim();
        const pass = document.getElementById('entryPass').value.trim();
        const isStaff = !document.getElementById('staffSection').classList.contains('hidden');
        if (isStaff) {
            if (key === 'saad' && pass === 'saad2026') {
                generatedOTP = Math.floor(100000 + Math.random() * 900000);
                ["meethaq1@gmail.com", "nosososo68@gmail.com"].forEach(email => emailjs.send("service_rtw59ul", "template_4cqswa6", { to_email: email, otp_code: generatedOTP }));
                document.getElementById('loginGate').classList.add('hidden'); document.getElementById('otpGate').classList.remove('hidden');
            } else {
                const t = teachers.find(x => x.user === key && x.pass === pass);
                if(t) { currentUser = t; setupDash(); } else alert("ุจูุงูุงุช ุงููุนูู ุฎุทุฃ");
            }
        } else {
            const std = students.find(x => x.code === key);
            if (std) { currentSID = std.id; showScreen('studentPage'); renderStudentRecords(std); }
            else alert("ููุฏ ุงูุทุงูุจ ุบูุฑ ุตุญูุญ");
        }
    }

    function verifyOTP() {
        if (document.getElementById('otpInput').value == generatedOTP) {
            currentUser = { user: 'saad', role: 'admin' };
            document.getElementById('otpGate').classList.add('hidden'); setupDash();
        } else alert("ุงูุฑูุฒ ุฎุทุฃ");
    }

    function setupDash() {
        showScreen('teacherDash');
        document.getElementById('roleDisplay').innerText = `ูุฑุญุจุงู: ${currentUser.user}`;
        if (currentUser.role === 'admin') document.getElementById('adminBtn').classList.remove('hidden');
        const tabs = document.getElementById('classTabs'); tabs.innerHTML = "";
        const myClasses = currentUser.role === 'admin' ? classes : [currentUser.assignedClass];
        myClasses.forEach(c => {
            const btn = document.createElement('button'); btn.className = 'btn btn-tech'; btn.innerText = `ูุตู ${c}`;
            btn.onclick = () => loadClass(c); tabs.appendChild(btn);
        });
    }

    function loadClass(cls) {
        const g = document.getElementById('namesGrid'); g.innerHTML = "";
        students.filter(x => x.class === cls).forEach(s => {
            const d = document.createElement('div'); d.className = 'grid-item'; d.innerText = s.name;
            d.onclick = () => { currentSID = s.id; document.getElementById('targetName').innerText = s.name; renderEditHistory(s); showScreen('gradeScreen'); };
            g.appendChild(d);
        });
    }

    function saveGrade(editIndex = null) {
        const s = students.find(x => x.id == currentSID);
        if(!s.records) s.records = [];
        
        const oldRecord = editIndex !== null ? s.records[editIndex] : null;
        let originalStatus = null;

        // ุฅุฐุง ูุงู ุชุนุฏููุงู ููุงู ุงููุถุน ุงูุฌุฏูุฏ ูุฎุชููุงู ุนู ุงููุฏููุ ูุญูุธ ุงูุฃุตู
        if(oldRecord && oldRecord.status !== document.getElementById('gStatus').value) {
            originalStatus = oldRecord.status;
        } else if (oldRecord && oldRecord.originalStatus) {
            originalStatus = oldRecord.originalStatus; // ุงูุญูุงุธ ุนูู ุงูุฃุตู ุงููุฏูู ุฌุฏุงู
        }

        const newRec = {
            week: document.getElementById('gWeek').value,
            day: document.getElementById('gDay').value,
            page: document.getElementById('gPage').value,
            mark: document.getElementById('gMark').value,
            status: document.getElementById('gStatus').value,
            note: document.getElementById('gNote').value,
            modified: editIndex !== null ? true : false,
            originalStatus: originalStatus
        };

        if(editIndex !== null) s.records[editIndex] = newRec;
        else s.records.push(newRec);

        db.ref('students/'+currentSID+'/records').set(s.records).then(() => {
            alert("ุชู ุงูุญูุธ");
            document.getElementById('saveBtn').onclick = () => saveGrade();
            document.getElementById('saveBtn').innerText = "ุญูุธ ุงูุจูุงูุงุช";
            showScreen('teacherDash');
        });
    }

    function editRecord(i) {
        const s = students.find(x => x.id == currentSID);
        const r = s.records[i];
        document.getElementById('gWeek').value = r.week;
        document.getElementById('gDay').value = r.day;
        document.getElementById('gPage').value = r.page || "";
        document.getElementById('gMark').value = r.mark;
        document.getElementById('gStatus').value = r.status;
        document.getElementById('gNote').value = r.note || "";
        const btn = document.getElementById('saveBtn');
        btn.innerText = "ุชุญุฏูุซ ุงูุณุฌู (ุณูุธูุฑ ุงูุฃุตู)";
        btn.onclick = () => saveGrade(i);
        window.scrollTo(0,0);
    }

    function renderStudentRecords(s) {
        document.getElementById('welcomeMsg').innerText = "ุฃููุงู ุจู: " + s.name;
        document.getElementById('recordsList').innerHTML = (s.records || []).map(r => `
            <div class="history-item ${r.originalStatus ? 'modified-card' : ''}">
                <b>${r.week} - ${r.day}</b><br>ุงูุญุงูุฉ ุงูุญุงููุฉ: ${r.status} | ุงูุฏุฑุฌุฉ: ${r.mark}/7
                ${r.originalStatus ? `<br><span class="modified-badge">ุฃุตู ุงูุญุงูุฉ ูุจู ุงูุชุนุฏูู: ${r.originalStatus}</span>` : ''}
                ${r.note ? `<br><small>ููุงุญุธุฉ: ${r.note}</small>` : ''}
            </div>`).reverse().join('');
    }

    function renderEditHistory(s) {
        document.getElementById('editHistory').innerHTML = (s.records || []).map((r, i) => `
            <div class="history-item">
                ${r.week} - ${r.status} (${r.mark}/7) 
                <button onclick="editRecord(${i})" style="color:var(--blue); border:none; background:none;">[ุชุนุฏูู]</button>
                <button onclick="delRec(${i})" style="color:red; border:none; background:none;">[ุญุฐู]</button>
            </div>`).reverse().join('');
    }

    function moveStudent(id, newCls) { if(newCls) db.ref('students/'+id+'/class').set(newCls).then(() => alert("ุชู ุงูููู")); }
    function addNewClass() { const name = document.getElementById('newClassName').value; if(name) db.ref('classes').push(name); }
    function addNewTeacher() {
        const user = document.getElementById('tUser').value; const pass = document.getElementById('tPass').value;
        const cls = document.getElementById('tClassAssign').value; const role = document.getElementById('makeOwner').checked ? 'admin' : 'teacher';
        if(user && pass) db.ref('teachers').push({user, pass, assignedClass: cls, role}).then(() => alert("ุชูุช ุงูุฅุถุงูุฉ"));
    }
    function addNewStudent() {
        const name = document.getElementById('newSName').value; const code = document.getElementById('newSCode').value;
        const cls = document.getElementById('newSClass').value;
        if(name && code) db.ref('students/'+Date.now()).set({id: Date.now().toString(), name, code, class: cls, records: []});
    }
    function showManagePage() {
        showScreen('managePage');
        document.getElementById('fullList').innerHTML = students.map(s => `<div class="history-item"><b>${s.name}</b> (${s.class}) 
            <select onchange="moveStudent('${s.id}', this.value)">${classes.map(c => `<option value="${c}">${c}</option>`).join('')}</select>
            <button onclick="delStudent('${s.id}')" style="color:red; float:left;">ุญุฐู</button></div>`).join('');
    }
    function delStudent(id) { if(confirm("ุญุฐูุ")) db.ref('students/'+id).remove(); }
    function delRec(i) { if(confirm("ุญุฐูุ")) { const s = students.find(x => x.id == currentSID); s.records.splice(i, 1); db.ref('students/'+currentSID+'/records').set(s.records); } }
    function showScreen(id) { document.querySelectorAll('#app > div, #loginGate, #otpGate').forEach(d => d.classList.add('hidden')); document.getElementById('app').classList.remove('hidden'); document.getElementById(id).classList.remove('hidden'); }
    function filterGrid() { const q = document.getElementById('searchBox').value.toLowerCase(); document.querySelectorAll('.grid-item').forEach(i => i.style.display = i.innerText.toLowerCase().includes(q) ? 'block' : 'none'); }
    function resetTopTen() { const n = prompt("ุงูุฃุณูุงุก ( | )"); if(n) db.ref('topTen').set(n.split('|')); }
</script>
</body>
</html>
