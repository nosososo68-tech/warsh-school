<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ù…Ø§Ù… ÙˆØ±Ø´ Ø§Ù„Ù…Ø·ÙˆØ± - Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø£Ø­Ù…Ø¯</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #1e4d2b; --secondary: #4a7c44; --gold: #d4af37; --white: #ffffff; --bg: #fdfaf5; --danger: #c0392b; }
        .theme-blue { --primary: #0a192f; --secondary: #112240; --gold: #64ffda; --bg: #f0f4f8; }
        .theme-orange { --primary: #d35400; --secondary: #e67e22; --gold: #c0392b; --bg: #fff5e6; }
        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; transition: 0.3s; }
        body { background-color: var(--bg); margin: 0; padding: 20px; text-align: center; }
        #lockScreen { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--primary); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .glass-card { background: white; padding: 40px; border-radius: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); width: 90%; max-width: 400px; border: 3px solid var(--gold); }
        #contactModal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6); z-index: 10001; display: none; align-items: center; justify-content: center; }
        .modal-box { background: white; padding: 30px; border-radius: 20px; max-width: 400px; width: 90%; border: 4px solid var(--primary); }
        .theme-selector { display: flex; gap: 10px; justify-content: center; margin: 15px 0; }
        .theme-btn { width: 30px; height: 30px; border-radius: 50%; border: 2px solid white; cursor: pointer; }
        .chart-container { background: white; padding: 20px; border-radius: 20px; margin-top: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .bar-chart { display: flex; align-items: flex-end; justify-content: space-around; height: 200px; padding-top: 20px; }
        .bar { width: 40px; background: linear-gradient(to top, var(--primary), var(--gold)); border-radius: 8px 8px 0 0; position: relative; animation: grow 1.5s ease-out; }
        .bar-label { position: absolute; bottom: -30px; width: 100%; font-size: 11px; font-weight: bold; transform: rotate(-20deg); }
        .bar-value { position: absolute; top: -25px; width: 100%; font-size: 12px; font-weight: bold; color: var(--primary); }
        @keyframes grow { from { height: 0; } }
        .container { max-width: 800px; margin: auto; }
        .card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 25px; border-bottom: 5px solid var(--gold); }
        .btn { padding: 14px; border: none; border-radius: 12px; cursor: pointer; font-weight: 700; width: 100%; margin: 5px 0; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-danger { background: var(--danger); color: white; padding: 5px 10px; width: auto; font-size: 12px; }
        input, select, textarea { width: 100%; padding: 14px; margin: 10px 0; border: 2px solid #eee; border-radius: 10px; text-align: center; }
        .hidden { display: none !important; }
        .st-row { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #eee; }
        footer { margin-top: 40px; font-size: 12px; color: #666; }
    </style>
</head>
<body id="bodyTag">

<div id="lockScreen">
    <div class="glass-card">
        <h2>Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¥Ù…Ø§Ù… ÙˆØ±Ø´</h2>
        <input type="password" id="siteKey" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„ÙˆØµÙˆÙ„">
        <button class="btn btn-primary" onclick="unlockSite()">ÙØªØ­ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
        <p style="font-size: 11px;">Ø§Ù„Ù…Ø·ÙˆØ±: Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø£Ø­Ù…Ø¯</p>
    </div>
</div>

<div id="contactModal">
    <div class="modal-box">
        <h3>Ø¹Ø²ÙŠØ²ÙŠ Ø§Ù„Ø·Ø§Ù„Ø¨ / ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± ğŸŒ¹</h3>
        <p>Ø¥Ø°Ø§ ÙˆØ§Ø¬Ù‡Øª Ø£ÙŠ Ù…Ø´ÙƒÙ„Ø©ØŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬:</p>
        <h4 style="color: var(--gold);">Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø£Ø­Ù…Ø¯</h4>
        <p style="font-weight: bold; font-size: 18px;">0599804296</p>
        <button class="btn btn-primary" onclick="closeModal()">Ù…ÙˆØ§ÙÙ‚ØŒ Ø¯Ø®ÙˆÙ„</button>
    </div>
</div>

<div class="container hidden" id="mainApp">
    <header>
        <h2>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¥Ù…Ø§Ù… ÙˆØ±Ø´</h2>
        <div class="theme-selector">
            <div class="theme-btn" style="background: #1e4d2b;" onclick="setTheme('default')"></div>
            <div class="theme-btn" style="background: #0a192f;" onclick="setTheme('theme-blue')"></div>
            <div class="theme-btn" style="background: #d35400;" onclick="setTheme('theme-orange')"></div>
        </div>
        <p style="background:var(--gold); padding:2px 15px; border-radius:20px; display:inline-block; font-size:12px;">Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø£Ø­Ù…Ø¯</p>
    </header>

    <div id="roleSelection">
        <div class="card">
            <button class="btn btn-primary" onclick="showScreen('loginScreen')">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø³Ø¹Ø¯</button>
            <button class="btn btn-secondary" onclick="prepareStudentView()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨</button>
        </div>
        <div class="chart-container">
            <h3>ğŸ† Ù„ÙˆØ­Ø© Ø´Ø±Ù Ø§Ù„Ù…ØªÙÙˆÙ‚ÙŠÙ† ğŸ†</h3>
            <div class="bar-chart" id="honorChart"></div>
        </div>
    </div>

    <div id="loginScreen" class="card hidden">
        <h3>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
        <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn btn-primary" onclick="teacherLogin()">Ø¯Ø®ÙˆÙ„</button>
        <button class="btn" onclick="showScreen('roleSelection')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="teacherDash" class="hidden">
        <div class="card">
            <input type="text" id="stName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
            <select id="stClass"><option value="3/1">ÙØµÙ„ 3/1</option><option value="3/2">ÙØµÙ„ 3/2</option></select>
            <button class="btn btn-primary" onclick="addStudent()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨</button>
            <div style="display:flex; gap:10px;">
                <button class="btn btn-secondary" onclick="loadClass('3/1')">ÙØµÙ„ 3/1</button>
                <button class="btn btn-secondary" onclick="loadClass('3/2')">ÙØµÙ„ 3/2</button>
            </div>
        </div>
        <div id="classStudentsList" class="card hidden"></div>
        <button class="btn" onclick="showScreen('roleSelection')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="gradingPage" class="hidden">
        <div class="card">
            <h3 id="activeStName">Ø§Ù„Ø§Ø³Ù…</h3>
            <input type="number" id="rPage" placeholder="Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø©">
            <select id="rStatus">
                <option value="Ø­ÙØ¸">Ø­ÙØ¸ âœ…</option>
                <option value="Ù„Ù… ÙŠØ­ÙØ¸">Ù„Ù… ÙŠØ­ÙØ¸ âŒ</option>
                <option value="Ù…Ø­Ø±ÙˆÙ…">Ù…Ø­Ø±ÙˆÙ… â›”</option>
                <option value="ØºØ§Ø¦Ø¨">ØºØ§Ø¦Ø¨ ğŸ’¤</option>
            </select>
            <select id="rScore">
                <option value="0">Ù„Ø§ ÙŠÙˆØ¬Ø¯ (0)</option>
                <option value="7">7 - Ù…Ù…ØªØ§Ø²</option>
                <option value="6">6 - Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹</option>
                <option value="5">5 - Ù…Ù‚Ø¨ÙˆÙ„</option>
                <option value="4">4 - Ø¶Ø¹ÙŠÙ</option>
            </select>
            <textarea id="rNote" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…..."></textarea>
            <button class="btn btn-primary" onclick="saveRecord()">Ø­ÙØ¸ ÙˆØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø¯Ø±Ø¬Ø©</button>
        </div>
        <button class="btn btn-secondary" onclick="showScreen('teacherDash')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <footer>
        <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù„Ù…Ø¨Ø±Ù…Ø¬ Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø£Ø­Ù…Ø¯ Â© 2026</p>
    </footer>
</div>

<script>
    const firebaseConfig = {
        databaseURL: "https://imam-warsh-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let students = [];
    let currentId = null;
    let currentClass = "";

    function loadData() {
        db.ref('students').on('value', (snapshot) => {
            const data = snapshot.val();
            students = data ? data : [];
            renderChart();
            if(currentClass) loadClass(currentClass);
        });
    }

    function saveData() { db.ref('students').set(students); }

    loadData();

    function setTheme(theme) { document.getElementById('bodyTag').className = (theme === 'default') ? '' : theme; }

    function unlockSite() {
        if(document.getElementById('siteKey').value === "2026") {
            document.getElementById('lockScreen').style.display = 'none';
            document.getElementById('mainApp').classList.remove('hidden');
        } else { alert("Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ø®Ø·Ø£!"); }
    }

    function prepareStudentView() { document.getElementById('contactModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('contactModal').style.display = 'none'; }

    function renderChart() {
        const chart = document.getElementById('honorChart');
        chart.innerHTML = "";
        let topStudents = students.map(s => {
            let total = s.records ? s.records.reduce((sum, r) => sum + parseInt(r.score || 0), 0) : 0;
            return { name: s.name, total: total };
        }).filter(s => s.total > 0).sort((a,b) => b.total - a.total).slice(0, 5);
        if(topStudents.length === 0) { chart.innerHTML = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ØªÙÙˆÙ‚ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</p>"; return; }
        const maxScore = topStudents[0].total;
        topStudents.forEach(s => {
            let height = (s.total / maxScore) * 100;
            chart.innerHTML += `<div class="bar" style="height: ${height}%"><span class="bar-value">${s.total}</span><span class="bar-label">${s.name.split(' ')[0]}</span></div>`;
        });
    }

    function showScreen(id) {
        document.querySelectorAll('.container > div').forEach(d => { if(d.id !== 'roleSelection') d.classList.add('hidden'); });
        document.getElementById('roleSelection').classList.add('hidden');
        document.getElementById(id).classList.remove('hidden');
    }

    function teacherLogin() {
        if(document.getElementById('username').value === 'saad' && document.getElementById('password').value === '1234567891011s') {
            showScreen('teacherDash');
        } else { alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø·Ø£!"); }
    }

    function addStudent() {
        const name = document.getElementById('stName').value;
        const cls = document.getElementById('stClass').value;
        if(name) { 
            students.push({id: Date.now(), name, class: cls, records: []}); 
            saveData(); 
            document.getElementById('stName').value = "";
        }
    }

    function deleteStudent(id) {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
            students = students.filter(s => s.id !== id);
            saveData();
        }
    }

    function loadClass(cls) {
        currentClass = cls;
        const list = document.getElementById('classStudentsList');
        list.classList.remove('hidden');
        list.innerHTML = `<h4>Ø·Ù„Ø§Ø¨ ÙØµÙ„ ${cls}</h4>`;
        students.filter(s => s.class === cls).forEach(s => {
            list.innerHTML += `
                <div class="st-row">
                    <span style="font-weight:bold;">${s.name}</span>
                    <div style="display:flex; gap:5px;">
                        <button class="btn btn-secondary" style="width:auto; padding:5px 10px;" onclick="openGrading(${s.id})">ØªØ³Ù…ÙŠØ¹</button>
                        <button class="btn btn-danger" onclick="deleteStudent(${s.id})">Ø­Ø°Ù</button>
                    </div>
                </div>`;
        });
    }

    function openGrading(id) {
        currentId = id;
        const s = students.find(x => x.id === id);
        document.getElementById('activeStName').innerText = s.name;
        showScreen('gradingPage');
    }

    function saveRecord() {
        const sIndex = students.findIndex(x => x.id === currentId);
        let score = document.getElementById('rScore').value;
        let status = document.getElementById('rStatus').value;
        if(status !== 'Ø­ÙØ¸') score = 0;
        if(!students[sIndex].records) students[sIndex].records = [];
        students[sIndex].records.unshift({
            date: new Date().toLocaleDateString('ar-SA'),
            page: document.getElementById('rPage').value,
            status: status,
            score: score,
            note: document.getElementById('rNote').value
        });
        saveData();
        alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
        showScreen('teacherDash');
    }
</script>
</body>
</html>
