<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… ÙˆØ±Ø´ Ø§Ù„Ø°ÙƒÙŠ | ØªØ·ÙˆÙŠØ± Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        :root { --p: #1e4d2b; --g: #d4af37; --bg: #f4f7f6; --card: #ffffff; --txt: #333; }
        .theme-dark { --p: #2c3e50; --g: #e74c3c; --bg: #1a1a1a; --card: #2c3e50; --txt: #ecf0f1; }
        .theme-desert { --p: #a0522d; --g: #daa520; --bg: #fdf5e6; --card: #ffffff; --txt: #5d4037; }
        .theme-sea { --p: #006994; --g: #20b2aa; --bg: #e0f7fa; --card: #ffffff; --txt: #01579b; }
        .theme-royal { --p: #4b0082; --g: #ffd700; --bg: #f3e5f5; --card: #ffffff; --txt: #311b92; }

        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; transition: 0.3s; }
        body { background: var(--bg); color: var(--txt); margin: 0; padding: 10px; direction: rtl; }
        .card { background: var(--card); border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin: 10px auto; max-width: 550px; border-top: 5px solid var(--g); position: relative; }
        .btn { padding: 12px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%; margin: 5px 0; font-size: 16px; }
        .btn-p { background: var(--p); color: white; }
        .btn-danger { background: #e53935; color: white; font-size: 11px; padding: 5px; border-radius: 5px; cursor: pointer; border:none; }
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #eee; border-radius: 10px; text-align: center; font-size: 16px; background: white; color: #333; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; }
        .grid-item { background: var(--p); color: white; padding: 10px; border-radius: 12px; cursor: pointer; font-size: 11px; text-align: center; height: 60px; display: flex; align-items: center; justify-content: center; }
        .progress-box { background: rgba(0,0,0,0.05); border: 2px solid var(--p); border-radius: 15px; padding: 15px; margin: 10px 0; text-align: center; }
        .progress-box h1 { margin: 5px 0; color: var(--p); font-size: 35px; }
        .honor-roll { background: #fffde7; border: 1px solid #fbc02d; padding: 10px; border-radius: 12px; margin-bottom: 10px; font-size: 13px; color: #333; }
        .footer-sticky { font-size: 10px; text-align: center; padding: 15px; color: #888; }
        .hidden { display: none !important; }
        .admin-table { width: 100%; font-size: 11px; border-collapse: collapse; margin-top: 10px; }
        .admin-table th, .admin-table td { border: 1px solid #eee; padding: 8px; text-align: center; }
        .theme-selector { display: flex; gap: 5px; justify-content: center; margin-bottom: 15px; }
        .theme-dot { width: 25px; height: 25px; border-radius: 50%; cursor: pointer; border: 2px solid #fff; box-shadow: 0 0 5px rgba(0,0,0,0.2); }
        .badge-re { background: #4caf50; color: white; padding: 2px 5px; border-radius: 4px; font-size: 9px; margin-right: 5px; }
        .stat-card { background: var(--p); color: white; padding: 10px; border-radius: 10px; text-align: center; font-size: 12px; flex: 1; }
    </style>
</head>
<body class="theme-default">

<div id="app">
    <div id="mainMenu" class="card">
        <h2 style="color:var(--p); text-align:center;">Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¥Ù…Ø§Ù… ÙˆØ±Ø´ ğŸ“š</h2>
        <p style="text-align:center; font-size:12px;">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„Ù…ÙØ¶Ù„ Ù„Ø¯ÙŠÙƒ:</p>
        <div class="theme-selector">
            <div class="theme-dot" style="background:#1e4d2b" onclick="setTheme('default')"></div>
            <div class="theme-dot" style="background:#2c3e50" onclick="setTheme('dark')"></div>
            <div class="theme-dot" style="background:#a0522d" onclick="setTheme('desert')"></div>
            <div class="theme-dot" style="background:#006994" onclick="setTheme('sea')"></div>
            <div class="theme-dot" style="background:#4b0082" onclick="setTheme('royal')"></div>
        </div>

        <input type="text" id="studentCode" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ">
        <button class="btn btn-p" onclick="studentLogin()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</button>
        <button class="btn" style="background:#455a64; color:white;" onclick="showScreen('staffLogin')">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø¹Ù„Ù… ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>

        <div style="background:#f9f9f9; padding:10px; border-radius:10px; margin-top:15px; text-align:center; border:1px dashed var(--p);">
            <small style="color:var(--p); font-weight:bold;">Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© ÙˆØ§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„ØªÙ‚Ù†ÙŠ:</small><br>
            <b>Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø£Ø­Ù…Ø¯</b><br>
            <small style="color:#666;">Ø§Ù„ÙÙƒØ±Ø© ÙˆØ§Ù„ØªØµÙ…ÙŠÙ…:</small><br>
            <b>ÙŠØ²Ù† Ø£Ù†Ø³ & Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ</b>
        </div>
    </div>

    <div id="studentPage" class="hidden card">
        <div class="honor-roll">ğŸ† <b>Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù:</b> <marquee id="topStudents" scrollamount="4"></marquee></div>
        <h3 id="welcomeMsg"></h3>
        <div class="progress-box">
            <span id="currentWeekDisplay"></span>
            <h1 id="weekCounter">0 / 0</h1>
            <div id="studentGrade" style="font-weight:bold; color:var(--g)">-</div>
        </div>
        <h4>Ø³Ø¬Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª ÙˆØ§Ù„Ø£Ø±Ø´ÙŠÙ:</h4>
        <div id="recordsList" style="max-height:300px; overflow-y:auto;"></div>
        <button class="btn btn-p" id="exitStudentBtn" onclick="showScreen('mainMenu')">Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="teacherDash" class="hidden card" style="max-width:800px;">
        <h3>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø³ØªØ§Ø° Ø³Ø¹Ø¯ ğŸ› ï¸</h3>
        <div style="background:#eee; padding:15px; border-radius:10px; margin-bottom:15px; color:#333;">
            <div style="display:flex; gap:10px;">
                <input type="number" id="globalWeekNum" placeholder="Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ">
                <input type="number" id="weeklyTarget" placeholder="Ø§Ù„Ù…Ù‚Ø±Ø±">
            </div>
            <button class="btn btn-p" onclick="updateSettings()">ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</button>
        </div>
        <div style="display:flex; gap:10px; margin-bottom:10px;">
            <button class="btn btn-p" onclick="loadClass('3/1')">Ø·Ù„Ø§Ø¨ ÙØµÙ„ 3/1</button>
            <button class="btn btn-p" onclick="loadClass('3/2')">Ø·Ù„Ø§Ø¨ ÙØµÙ„ 3/2</button>
        </div>
        <div id="namesGrid" class="grid"></div>
        <hr>
        <button class="btn" style="background:#607d8b; color:white;" onclick="showManageStudents()">Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</button>
        <button class="btn" onclick="showScreen('mainMenu')">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="adminDash" class="hidden card" style="max-width:900px;">
        <h3 style="color:var(--p)">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ğŸ“Š</h3>
        
        <div style="display:flex; gap:10px; margin-bottom:15px;">
            <div class="stat-card">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨: <b id="statTotal">0</b></div>
            <div class="stat-card">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­ÙØ¸: <b id="statHafiz">0</b></div>
            <div class="stat-card">Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ù†Ø¬Ø§Ø²: <b id="statPerc">0%</b></div>
        </div>

        <h4 onclick="toggleAdminTable('adminTable31')" style="cursor:pointer; background:#eee; padding:10px; border-radius:5px;">ğŸ“ Ø·Ù„Ø§Ø¨ ÙØµÙ„ 3/1 (Ø§Ù†Ù‚Ø± Ù„Ù„Ø¹Ø±Ø¶)</h4>
        <div id="adminTable31" class="hidden" style="overflow-x:auto;">
            <table class="admin-table">
                <thead><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨ (Ø§Ø¶ØºØ· Ù„Ù„Ø¹Ø±Ø¶)</th><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø¢Ø®Ø± Ø¥Ù†Ø¬Ø§Ø²</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead>
                <tbody id="list31"></tbody>
            </table>
        </div>

        <h4 onclick="toggleAdminTable('adminTable32')" style="cursor:pointer; background:#eee; padding:10px; border-radius:5px; margin-top:10px;">ğŸ“ Ø·Ù„Ø§Ø¨ ÙØµÙ„ 3/2 (Ø§Ù†Ù‚Ø± Ù„Ù„Ø¹Ø±Ø¶)</h4>
        <div id="adminTable32" class="hidden" style="overflow-x:auto;">
            <table class="admin-table">
                <thead><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨ (Ø§Ø¶ØºØ· Ù„Ù„Ø¹Ø±Ø¶)</th><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø¢Ø®Ø± Ø¥Ù†Ø¬Ø§Ø²</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead>
                <tbody id="list32"></tbody>
            </table>
        </div>

        <button class="btn btn-p" style="margin-top:20px;" onclick="showScreen('mainMenu')">Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="gradeScreen" class="hidden card">
        <h3 id="targetName"></h3>
        <input type="number" id="gWeek" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹">
        <input type="text" id="gDay" placeholder="Ø§Ù„ÙŠÙˆÙ…">
        <input type="number" id="gPage" placeholder="Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø©">
        <select id="gStatus">
            <option value="Ø­Ø§ÙØ¸">Ø­Ø§ÙØ¸ âœ…</option>
            <option value="Ù„Ù… ÙŠØ­ÙØ¸">Ù„Ù… ÙŠØ­ÙØ¸ âš ï¸</option>
            <option value="Ù„Ù… ÙŠØ³Ù…Ø¹">Ù„Ù… ÙŠØ³Ù…Ø¹ âŒ</option>
            <option value="Ù…Ø­Ø±ÙˆÙ…">Ù…Ø­Ø±ÙˆÙ… ğŸš«</option>
            <option value="ØºØ§Ø¦Ø¨">ØºØ§Ø¦Ø¨ ğŸ’¤</option>
        </select>
        <textarea id="gNote" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø© (Ø¥Ù„Ø²Ø§Ù…ÙŠØ© ÙÙŠ Ø­Ø§Ù„ Ø§Ù„ØªÙ‚ØµÙŠØ±)"></textarea>
        <button class="btn btn-p" onclick="saveGrade()">Ø­ÙØ¸ Ø§Ù„Ø¯Ø±Ø¬Ø©</button>
        <button class="btn" onclick="showScreen('teacherDash')">Ø¥Ù„ØºØ§Ø¡</button>
    </div>

    <div id="manageStudentsPage" class="hidden card">
        <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</h3>
        <div style="background:#f0f0f0; padding:15px; border-radius:10px; margin-bottom:15px;">
            <input type="text" id="newSName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
            <input type="text" id="newSCode" placeholder="Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„">
            <select id="newSClass">
                <option value="3/1">ÙØµÙ„ 3/1</option>
                <option value="3/2">ÙØµÙ„ 3/2</option>
            </select>
            <button class="btn btn-p" onclick="addNewStudent()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
        </div>
        <div style="overflow-y:auto; max-height:300px;">
            <table class="admin-table">
                <tbody id="adminStudentsList"></tbody>
            </table>
        </div>
        <button class="btn" onclick="showScreen('teacherDash')">Ø±Ø¬ÙˆØ¹</button>
    </div>

    <div id="staffLogin" class="hidden card">
        <h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙƒØ§Ø¯Ø±</h3>
        <input type="text" id="user" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn btn-p" onclick="staffAuth()">Ø¯Ø®ÙˆÙ„</button>
        <button class="btn" onclick="showScreen('mainMenu')">Ø±Ø¬ÙˆØ¹</button>
    </div>
</div>

<footer class="footer-sticky">
    <b>Ø§Ù„Ù…Ø¨Ø±Ù…Ø¬ Ø§Ù„Ù…Ø·ÙˆØ±: Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø£Ø­Ù…Ø¯</b> <br>
    Ø£ÙÙƒØ§Ø±: ÙŠØ²Ù† Ø£Ù†Ø³ ÙˆÙ…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ | 2026 Â©
</footer>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAC9BzBpw66oBDriZoi9A5zsThKLFZiNv8", databaseURL: "https://imam-warsh-default-rtdb.asia-southeast1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const initialStudents = [
        {id:3278, name:"Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø­Ø§Ø±Ø«ÙŠ", code:"3278", class:"3/2"}, {id:3214, name:"Ø§Ù†Ø³ Ù…Ø­Ù…Ø¯ Ø¹ÙŠØ³Ù‰", code:"3214", class:"3/2"}, {id:3291, name:"ØªÙŠØ³ÙŠØ± Ø±Ø¶Ø§ Ø§Ù„Ù…Ø­Ù…Ø¯ÙŠ", code:"3291", class:"3/2"},
        {id:3246, name:"Ø­Ø³Ø§Ù† Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„Ø¬Ø§Ø¨Ø±ÙŠ", code:"3246", class:"3/2"}, {id:3283, name:"Ø­Ø³Ù† Ø¹Ø¨Ø¯Ù‡", code:"3283", class:"3/2"}, {id:3209, name:"Ø¹Ø§Ù…Ø± ÙŠÙˆØ³Ù Ø§Ù„Ø¬Ù‡Ù†ÙŠ", code:"3209", class:"3/2"},
        {id:3267, name:"Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ù…Ø§Ø¬Ø¯ Ø§Ù„Ø±Ø®ÙŠÙ…ÙŠ", code:"3267", class:"3/2"}, {id:3235, name:"Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø¹Ù…Ø± Ø§Ù„Ø±ÙˆÙŠØ«ÙŠ", code:"3235", class:"3/2"}, {id:3298, name:"Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† ØµØºÙŠØ±", code:"3298", class:"3/2"},
        {id:3218, name:"Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø­ÙƒÙ…ÙŠ", code:"3218", class:"3/2"}, {id:3271, name:"Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ù…Ø±ÙˆØ§Ù†", code:"3271", class:"3/2"}, {id:3242, name:"Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ ÙÙ‡Ø¯ Ø§Ù„Ø´Ù†Ù‚ÙŠØ·ÙŠ", code:"3242", class:"3/2"},
        {id:3289, name:"Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø¨Ø¯Ø± Ø§Ù„Ø¹ÙˆÙÙŠ", code:"3289", class:"3/2"}, {id:3226, name:"Ø¹Ø¨Ø¯Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø¹Ø¨Ø¯Ø§Ù„Ù‡Ø§Ø¯ÙŠ Ø§Ù„Ø¹Ù…Ø±ÙŠ", code:"3226", class:"3/2"}, {id:3275, name:"Ø¹Ø¨Ø¯Ø§Ù„Ù…Ù„Ùƒ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¬Ù‡Ù†ÙŠ", code:"3275", class:"3/2"},
        {id:3207, name:"Ø¹Ø¨Ø¯Ø§Ù„Ù…Ù„Ùƒ Ø¹ÙŠØ§Ø¯Ù‡ Ø§Ù„Ø¬Ù‡Ù†ÙŠ", code:"3207", class:"3/2"}, {id:3294, name:"Ø¹Ù…Ø§Ø¯ Ø­Ù…Ø¯Ø§Ù† Ø§Ù„Ø§Ø­Ù…Ø¯ÙŠ", code:"3294", class:"3/2"}, {id:3231, name:"Ø¹Ù…Ø± Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ù„Ø³Ù‡Ù„ÙŠ", code:"3231", class:"3/2"},
        {id:3260, name:"Ø¹Ù…Ø± Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø³Ø§Ø¹Ø¯ÙŠ", code:"3260", class:"3/2"}, {id:3281, name:"ÙÙŠØµÙ„ Ù‚ÙˆØ´ÙŠØ­", code:"3281", class:"3/2"}, {id:3212, name:"Ù„Ø²Ø§Ù… Ù…Ø§Ù‡Ø± Ø§Ø¨Ùˆ Ø­Ø³ÙŠÙ†", code:"3212", class:"3/2"},
        {id:3279, name:"Ù…Ø§Ù„Ùƒ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¬Ù‡Ù†ÙŠ", code:"3279", class:"3/2"}, {id:3249, name:"Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ Ø§Ù„Ø£Ù…ÙŠÙ†", code:"3249", class:"3/2"}, {id:3290, name:"Ù…Ø­Ù…Ø¯ Ø§Ù„ØªØ±Ø§Ø¯", code:"3290", class:"3/2"},
        {id:3205, name:"Ù…Ø­Ù…Ø¯ Ø¨Ù†Ø¯Ø± Ø§Ù„Ø¬Ù‡Ù†ÙŠ", code:"3205", class:"3/2"}, {id:3264, name:"Ù…Ø­Ù…Ø¯ Ø³Ø§Ù„Ù… Ø§Ù„Ø¬Ù‡Ù†ÙŠ", code:"3264", class:"3/2"}, {id:3286, name:"Ù…Ø­Ù…Ø¯ Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø¬Ù‡Ù†ÙŠ", code:"3286", class:"3/2"},
        {id:3223, name:"Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ Ø§Ù„Ø´Ù†Ù‚ÙŠØ·ÙŠ", code:"3223", class:"3/2"}, {id:3273, name:"Ù…Ø­Ù…Ø¯ Ù…Ù†ÙˆØ± Ø§Ù„Ø¹Ù†Ø²ÙŠ", code:"3273", class:"3/2"}, {id:3216, name:"Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ø­Ù…Ø¯", code:"3216", class:"3/2"},
        {id:3210, name:"ÙŠØ²Ù† Ø§Ù†Ø³ Ø§Ù„Ù…Ø­Ù…Ø¯ÙŠ", code:"3210", class:"3/2"},
        {id:3101, name:"Ø§Ø­Ù…Ø¯ Ø¨ÙƒØ± Ø³ÙŠÙƒÙˆ Ø¬ÙŠØ§Ù†ÙŠ", code:"3101", class:"3/1"}, {id:3102, name:"Ø§Ø­Ù…Ø¯ Ø®Ø§Ù„Ø¯ Ø­Ù…Ø¯Ø§Ù† Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ", code:"3102", class:"3/1"}, {id:3103, name:"Ø§Ø­Ù…Ø¯ Ù†Ø§ØµØ± Ø§Ø­Ù…Ø¯ Ø¹Ù…Ø±", code:"3103", class:"3/1"},
        {id:3104, name:"Ø§Ø³Ø§Ù…Ù‡ Ø§Ø¨Ø§Ù‡ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø£Ù…ÙŠÙ†", code:"3104", class:"3/1"}, {id:3105, name:"Ø§Ù…ÙŠÙ† Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù†Ù‚ÙŠØ·ÙŠ", code:"3105", class:"3/1"}, {id:3106, name:"Ø£Ù…ÙŠÙ† Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ø·ÙŠÙ Ù…Ø­Ù…Ø¯", code:"3106", class:"3/1"},
        {id:3107, name:"Ø£Ù†Ø³ Ø­ÙŠØ¯Ø± ÙŠØ­ÙŠÙ‰ Ù†Ø®ÙŠÙÙŠ", code:"3107", class:"3/1"}, {id:3108, name:"Ø§ÙŠØ§Ø¯ Ø­Ù…Ø²Ù‡ Ø±Ø§Ø¬Ø­ Ø§Ù„Ø§Ø­Ù…Ø¯ÙŠ", code:"3108", class:"3/1"}, {id:3109, name:"ØªÙ…ÙŠÙ… Ø·Ø§Ø±Ù‚ Ø¨Ù† Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ", code:"3109", class:"3/1"},
        {id:3110, name:"ØªÙ…ÙŠÙ… ÙÙ‡Ø¯ Ø¨Ù† Ø¬Ø²Ø§Ø¡ Ø§Ù„ØªÙ…ÙŠÙ…ÙŠ", code:"3110", class:"3/1"}, {id:3111, name:"Ø¬Ù‡Ø§Ø¯ Ù…Ø´Ø¹Ù„ Ø³Ø¹ÙŠØ¯ Ø§Ù„Ø±Ø¯Ø§Ø¯ÙŠ", code:"3111", class:"3/1"}, {id:3112, name:"Ø­Ù…Ø²Ù‡ Ù…Ø­Ù…Ø¯ Ù†ÙˆØ± Ø±ÙŠØ§Ø¶ Ø´Ø§Ù‡ÙŠÙ†", code:"3112", class:"3/1"},
        {id:3113, name:"Ø±Ø§Ø´Ø¯ Ø¹Ù…Ø± Ø¨Ù† Ø¹Ù„ÙŠ Ø§Ù„Ø§Ø­Ù…Ø¯ÙŠ", code:"3113", class:"3/1"}, {id:3114, name:"Ø±ÙŠØ§Ù† Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø¨Ø± Ù…Ø­Ù…Ø¯", code:"3114", class:"3/1"}, {id:3115, name:"Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­ÙŠÙ… Ù…Ø­Ù…Ø¯ Ø§Ù„Ø§Ù…ÙŠÙ† Ø§Ù„Ø´Ù†Ù‚ÙŠØ·ÙŠ", code:"3115", class:"3/1"},
        {id:3116, name:"Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø¨Ø®Ø§Ø±ÙŠ", code:"3116", class:"3/1"}, {id:3117, name:"Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ø¬Ø²Ø§Ø¡ Ø§Ù„ØªÙ…ÙŠÙ…ÙŠ", code:"3117", class:"3/1"}, {id:3118, name:"Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…ÙˆØ¯ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù†Ù‚ÙŠØ·ÙŠ", code:"3118", class:"3/1"},
        {id:3119, name:"Ø¹Ø¨Ø¯Ø§Ù„Ù…Ù„Ùƒ Ø³Ø¹Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ø±ÙŠØ¯Ù‡", code:"3119", class:"3/1"}, {id:3120, name:"Ø¹Ù…Ø± Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø­Ø¶ÙŠØ¶ Ø§Ù„ØªÙ…ÙŠÙ…ÙŠ", code:"3120", class:"3/1"}, {id:3121, name:"Ø¹Ù…Ø± Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù…Ø±ÙŠ", code:"3121", class:"3/1"},
        {id:3122, name:"Ø¹Ù…Ø± Ø¹Ø¨Ø¯Ø§Ù„ÙˆØ§Ø­Ø¯ Ø§Ø­Ù…Ø¯ Ø¨ÙƒØ§Ø±ÙŠ", code:"3122", class:"3/1"}, {id:3123, name:"Ù‚Ø§Ø³Ù… Ø¨Ù†Ø¯Ø± Ø¨Ù† Ù‚Ø§Ø³Ù… Ø§Ù„Ø§Ù†ØµØ§Ø±ÙŠ", code:"3123", class:"3/1"}, {id:3124, name:"Ù‚ØµÙŠ Ø³Ø¹Ø¯ÙŠ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø«ÙŠÙ…ÙŠÙ†ÙŠ", code:"3124", class:"3/1"},
        {id:3125, name:"Ù…Ø­Ù…Ø¯ Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø´Ù†Ù‚ÙŠØ·ÙŠ", code:"3125", class:"3/1"}, {id:3126, name:"Ù…Ø­Ù…Ø¯ Ù…Ø®ØªØ§Ø± Ø¨Ù† Ù…Ø­Ù…Ø¯ ÙˆÙ„Ø¯ Ø§Ø¨Ø§", code:"3126", class:"3/1"}, {id:3127, name:"Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø§Ø¨Ø¯ Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´Ù†Ù‚ÙŠØ·ÙŠ", code:"3127", class:"3/1"},
        {id:3128, name:"Ù…ØµØ·ÙÙ‰ Ø¹Ù…Ø± Ø¨Ù† Ø§Ù„Ø£Ù…ÙŠÙ† Ø§Ù„Ø´Ù†Ù‚ÙŠØ·ÙŠ", code:"3128", class:"3/1"}, {id:3129, name:"Ù…Ø¹Ø§Ø° Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ø·ÙŠØ¨ Ø§Ù„ÙˆÙ„ÙŠ", code:"3129", class:"3/1"}, {id:3130, name:"Ù…Ø¹Ø§Ø° Ø§Ù„Ø§Ù…ÙŠÙ† Ø¨Ù† Ø®Ø¶Ø± Ø§Ù„Ø´Ù†Ù‚ÙŠØ·ÙŠ", code:"3130", class:"3/1"}
    ];

    let students = []; let settings = { currentWeek: 1, target: 4 }; let currentSID = null;

    db.ref('students').on('value', s => { 
        if(!s.exists()) { initialStudents.forEach(st => db.ref('students/' + st.id).set(st)); }
        students = s.exists() ? Object.values(s.val()) : [];
        updateHonorRoll();
    });
    db.ref('settings').on('value', s => { if(s.exists()) settings = s.val(); });

    function setTheme(t) { document.body.className = t === 'default' ? '' : 'theme-' + t; }

    function studentLogin() {
        const inputCode = document.getElementById('studentCode').value.trim();
        const s = students.find(x => String(x.code).trim() === inputCode);
        if(s) { renderStudentPage(s); showScreen('studentPage'); document.getElementById('exitStudentBtn').onclick = () => showScreen('mainMenu'); }
        else alert('Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­!');
    }

    function renderStudentPage(s) {
        document.getElementById('welcomeMsg').innerText = `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ: ${s.name}`;
        document.getElementById('currentWeekDisplay').innerText = `Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹: ${settings.currentWeek}`;
        const weekRecs = (s.records || []).filter(r => r.week == settings.currentWeek && r.status === "Ø­Ø§ÙØ¸");
        document.getElementById('weekCounter').innerText = `${weekRecs.length} / ${settings.target}`;
        document.getElementById('recordsList').innerHTML = (s.records || []).map(r => `
            <div style="padding:10px; margin-bottom:8px; background:rgba(255,255,255,0.9); border-radius:8px; border-right:5px solid ${getStatusColor(r.status)};">
                <b>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${r.week} - ${r.day}</b> | Øµ ${r.page} ${r.isRe ? '<span class="badge-re">ØªØ¹Ø¯ÙŠÙ„/Ø¥Ø¹Ø§Ø¯Ø©</span>' : ''}
                <div style="color:${getStatusColor(r.status)}">${r.status}</div>
                <div style="font-size:11px; color:#666;">${r.note || ''}</div>
            </div>
        `).join('');
    }

    function loadClass(cls) {
        const grid = document.getElementById('namesGrid'); grid.innerHTML = "";
        students.filter(x => x.class === cls).forEach(s => {
            const div = document.createElement('div'); div.className = "grid-item"; div.innerText = s.name;
            div.onclick = () => { currentSID = s.id; document.getElementById('targetName').innerText = `Ø±ØµØ¯: ${s.name}`; document.getElementById('gWeek').value = settings.currentWeek; showScreen('gradeScreen'); };
            grid.appendChild(div);
        });
    }

    function saveGrade() {
        const s = students.find(x => x.id == currentSID);
        const week = document.getElementById('gWeek').value;
        const page = document.getElementById('gPage').value;
        const status = document.getElementById('gStatus').value;
        const note = document.getElementById('gNote').value;
        if((status !== 'Ø­Ø§ÙØ¸' && status !== 'ØºØ§Ø¦Ø¨') && !note) return alert('ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ù…Ù„Ø§Ø­Ø¸Ø© ØªÙˆØ¶Ø­ Ø§Ù„Ø³Ø¨Ø¨!');
        if(!s.records) s.records = [];
        
        // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø©: Ø¥Ø°Ø§ ÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ù„Ù†ÙØ³ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ÙˆØ§Ù„ØµÙØ­Ø© ÙŠØªÙ… Ø­Ø°ÙÙ‡ Ø£ÙˆÙ„Ø§Ù‹
        const existingIdx = s.records.findIndex(r => r.week == week && r.page == page);
        let isRe = false;
        if(existingIdx !== -1) {
            isRe = true;
            s.records.splice(existingIdx, 1);
        }

        s.records.unshift({ week, day: document.getElementById('gDay').value, page, status, note, isRe });
        db.ref('students/' + currentSID + '/records').set(s.records).then(() => { alert('ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«'); showScreen('teacherDash'); });
    }

    function staffAuth() {
        const u = document.getElementById('user').value;
        const p = document.getElementById('pass').value;
        if(u === 'saad' && p === '12345678w') showScreen('teacherDash');
        else if(u === 'admin' && p === 'admin2026') {
            renderAdminDash();
            showScreen('adminDash');
        } else alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    }

    function renderAdminDash() {
        const list31 = document.getElementById('list31');
        const list32 = document.getElementById('list32');
        list31.innerHTML = ""; list32.innerHTML = "";
        
        let totalHafiz = 0;
        students.forEach(s => {
            const lastRec = (s.records || [{}])[0];
            const row = `<tr style="cursor:pointer" onclick="viewAsStudent(${s.id})">
                <td>${s.name}</td><td>${s.code}</td><td>${lastRec.page || '-'}</td><td>${lastRec.status || '-'}</td>
            </tr>`;
            if(s.class === '3/1') list31.innerHTML += row;
            else list32.innerHTML += row;
            
            totalHafiz += (s.records || []).filter(r => r.status === 'Ø­Ø§ÙØ¸').length;
        });

        document.getElementById('statTotal').innerText = students.length;
        document.getElementById('statHafiz').innerText = totalHafiz;
        document.getElementById('statPerc').innerText = students.length ? Math.round((totalHafiz / (students.length * settings.target * settings.currentWeek)) * 100) + '%' : '0%';
    }

    function viewAsStudent(sid) {
        const s = students.find(x => x.id == sid);
        renderStudentPage(s);
        showScreen('studentPage');
        document.getElementById('exitStudentBtn').onclick = () => showScreen('adminDash');
    }

    function toggleAdminTable(id) { document.getElementById(id).classList.toggle('hidden'); }

    function getStatusColor(s) { return {'Ø­Ø§ÙØ¸':'green', 'Ù„Ù… ÙŠØ­ÙØ¸':'orange', 'Ù„Ù… ÙŠØ³Ù…Ø¹':'red', 'Ù…Ø­Ø±ÙˆÙ…':'black', 'ØºØ§Ø¦Ø¨':'gray'}[s] || 'blue'; }
    function showScreen(id) { document.querySelectorAll('#app > div').forEach(d => d.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
    
    function showManageStudents() { 
        document.getElementById('adminStudentsList').innerHTML = students.map(s => `<tr><td>${s.name} (${s.class})</td><td><button class="btn-danger" onclick="deleteStudent(${s.id})">Ø­Ø°Ù</button></td></tr>`).join(''); 
        showScreen('manageStudentsPage'); 
    }

    function addNewStudent() {
        const id = Date.now();
        const name = document.getElementById('newSName').value;
        const code = document.getElementById('newSCode').value;
        const cls = document.getElementById('newSClass').value;
        if(name && code) {
            db.ref('students/' + id).set({ id, name, code, class: cls }).then(() => { 
                alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨'); 
                document.getElementById('newSName').value = "";
                document.getElementById('newSCode').value = "";
                showManageStudents(); 
            });
        }
    }

    function deleteStudent(id) { if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) db.ref('students/' + id).remove().then(() => showManageStudents()); }
    
    function updateSettings() { db.ref('settings').update({ currentWeek: document.getElementById('globalWeekNum').value, target: document.getElementById('weeklyTarget').value }); alert('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«'); }
    
    function updateHonorRoll() {
        const sorted = [...students].sort((a,b) => ((b.records||[]).filter(r=>r.status==='Ø­Ø§ÙØ¸').length) - ((a.records||[]).filter(r=>r.status==='Ø­Ø§ÙØ¸').length));
        document.getElementById('topStudents').innerText = sorted.slice(0, 10).map((s, i) => `${i+1}. ${s.name}`).join(' | ');
    }
</script>
</body>
</html>
