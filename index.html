<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Ù†Ø¸Ø§Ù… Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¥Ù…Ø§Ù… ÙˆØ±Ø´ Ø§Ù„Ø°ÙƒÙŠ v3.0 | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© Ø§Ù„ÙØ§Ø®Ø±Ø©</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<style>

    /* 1. Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø´Ø§Ù…Ù„ (Root) */

    :root {

        --primary: #2c3e50;

        --secondary: #34495e;

        --success: #27ae60;

        --danger: #e74c3c;

        --warning: #f39c12;

        --info: #3498db;

        --light: #f4f7f6;

        --dark: #1a1a2e;

        --white: #ffffff;

        --shadow: 0 10px 30px rgba(0,0,0,0.1);

        --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);

    }



    /* 2. Ø«ÙŠÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© */

    [data-theme="dark"] {

        --light: #1a1a2e;

        --white: #16213e;

        --primary: #e94560;

        --txt: #ffffff;

    }



    /* 3. Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù„Ù„Ù‡ÙŠÙƒÙ„ */

    * { 

        box-sizing: border-box; 

        font-family: 'Tajawal', sans-serif; 

        transition: var(--transition); 

    }



    body { 

        background: var(--light); 

        color: var(--primary); 

        margin: 0; 

        padding: 15px; 

        display: flex; 

        flex-direction: column; 

        align-items: center; 

        min-height: 100vh; 

        line-height: 1.6;

    }



    /* 4. ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª (Cards) */

    .card { 

        background: var(--white); 

        border-radius: 25px; 

        padding: 30px; 

        box-shadow: var(--shadow); 

        width: 100%; 

        max-width: 950px; 

        margin: 15px 0; 

        position: relative; 

        border: 1px solid rgba(0,0,0,0.05); 

        overflow: hidden;

    }



    .mustafa-tag { 

        color: var(--success); 

        font-weight: 700; 

        font-size: 14px; 

        text-align: center; 

        display: block; 

        margin: 15px 0; 

        border-bottom: 2px solid #f0f0f0; 

        padding-bottom: 10px;

        letter-spacing: 1px;

    }



    /* 5. Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© */

    .btn { 

        padding: 15px 25px; 

        border: none; 

        border-radius: 15px; 

        cursor: pointer; 

        font-weight: 700; 

        width: 100%; 

        margin: 8px 0; 

        font-size: 16px; 

        display: flex; 

        align-items: center; 

        justify-content: center; 

        gap: 10px; 

        box-shadow: 0 4px 15px rgba(0,0,0,0.1);

    }



    .btn:active { transform: scale(0.98); }

    .btn-tech { background: linear-gradient(135deg, var(--success), #2ecc71); color: white; }

    .btn-danger { background: linear-gradient(135deg, var(--danger), #ff7675); color: white; }

    .btn-info { background: linear-gradient(135deg, var(--info), #81ecec); color: white; }

    .btn-back { 

        background: rgba(0,0,0,0.05); 

        color: var(--primary); 

        width: auto; 

        padding: 8px 20px; 

        position: absolute; 

        top: 20px; 

        right: 20px; 

        z-index: 100; 

        border-radius: 10px; 

        font-size: 12px;

    }



    /* 6. Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª (Inputs) */

    input, select, textarea { 

        width: 100%; 

        padding: 16px; 

        margin: 10px 0; 

        border-radius: 15px; 

        border: 2px solid #eee; 

        background: #fafafa; 

        font-size: 15px; 

        outline: none;

    }



    input:focus { border-color: var(--info); background: #fff; box-shadow: 0 0 10px rgba(52, 152, 219, 0.1); }



    .hidden { display: none !important; }



    /* 7. Ø´Ø¨ÙƒØ© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø¨ÙˆÙƒØ³Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ */

    .grid { 

        display: grid; 

        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 

        gap: 20px; 

        margin-top: 25px; 

        width: 100%;

    }



    .grid-item { 

        background: var(--white); 

        padding: 25px; 

        border-radius: 20px; 

        text-align: center; 

        border: 2px solid #eef2f3; 

        cursor: pointer; 

        position: relative;

        box-shadow: 0 5px 15px rgba(0,0,0,0.02);

    }



    /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø© */

    .status-Ø­Ø§ÙØ¸ { background: #e8f5e9 !important; border-color: #2ecc71 !important; color: #1b5e20 !important; }

    .status-ØºÙŠØ±-Ø­Ø§ÙØ¸ { background: #fffde7 !important; border-color: #f1c40f !important; color: #f39c12 !important; }

    .status-ØºØ§Ø¦Ø¨ { background: #e3f2fd !important; border-color: #3498db !important; color: #0d47a1 !important; }

    .status-Ù„Ù…-ÙŠØ³Ù…Ø¹ { background: #ffebee !important; border-color: #e74c3c !important; color: #c0392b !important; }

    .status-Ù…Ø­Ø±ÙˆÙ… { background: #34495e !important; border-color: #2c3e50 !important; color: #ffffff !important; }



    /* 8. Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® */

    .history-item { 

        background: #f8f9fa; 

        padding: 20px; 

        border-radius: 15px; 

        margin-bottom: 15px; 

        border-right: 8px solid var(--success); 

        position: relative;

    }



    .original-badge { 

        background: var(--warning); 

        color: #fff; 

        padding: 4px 10px; 

        border-radius: 8px; 

        font-size: 11px; 

        margin-top: 10px; 

        display: inline-block; 

    }



    /* 9. Ù‚Ø³Ù… Ø§Ù„Ø´Ø±Ø­ ÙˆØ§Ù„Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ */

    .guide-step { 

        background: #fff; 

        padding: 20px; 

        border-radius: 20px; 

        margin-bottom: 25px; 

        border-left: 6px solid var(--info);

        box-shadow: 0 5px 15px rgba(0,0,0,0.05);

    }



    .guide-img { 

        width: 100%; 

        border-radius: 15px; 

        margin: 15px 0; 

        border: 4px solid #f0f0f0; 

        display: block;

    }



    /* 10. Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± */

    @media print {

        .no-print { display: none !important; }

        body { background: white; padding: 0; }

        .card { box-shadow: none; border: 1px solid #ccc; width: 100%; max-width: 100%; }

    }



    /* 11. Ø§Ù„ÙÙˆØªØ± */

    footer { 

        margin-top: 50px; 

        padding: 30px; 

        text-align: center; 

        border-top: 2px solid #eee; 

        width: 100%; 

        color: #7f8c8d;

    }



    /* 12. ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù†ØªÙ‚Ø§Ù„Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */

    .stats-box {

        display: grid;

        grid-template-columns: repeat(3, 1fr);

        gap: 15px;

        margin-bottom: 20px;

    }

    .stat-card {

        background: var(--light);

        padding: 15px;

        border-radius: 15px;

        text-align: center;

    }

</style>

</head><body><div id="loginGate" class="card no-print"><div class="mustafa-tag">| Ù†Ø¸Ø§Ù… Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¥Ù…Ø§Ù… ÙˆØ±Ø´ Ø§Ù„Ø°ÙƒÙŠ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© Ø§Ù„ÙØ§Ø®Ø±Ø© v3.0 |</div>

<div style="text-align:center; margin-bottom: 30px;">

    <img src="https://cdn-icons-png.flaticon.com/512/2602/2602414.png" width="90" alt="Logo">

    <h2 style="margin-top:15px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù… ğŸ›¡ï¸</h2>

</div>



<div class="input-group">

    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨:</label>

    <input type="text" id="entryKey" placeholder="Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù‡Ù†Ø§...">

</div>



<div id="staffSection" class="hidden">

    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø³Ø±ÙŠØ©:</label>

    <input type="password" id="entryPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">

</div>



<button class="btn btn-tech" onclick="mainAuth()">ğŸš€ Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù† Ù„Ù„Ù†Ø¸Ø§Ù…</button>

<button class="btn" style="background:transparent; color:var(--primary); box-shadow:none;" onclick="toggleStaff()">Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙƒØ§Ø¯Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ / Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</button>

</div><div id="app" class="hidden" style="width:100%; max-width:950px;"><div id="teacherDash" class="hidden card no-print">

    <button class="btn btn-back" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

    <div id="roleDisplay" class="mustafa-tag"></div>



    <div class="stats-box">

        <div class="stat-card"><h4>ÙØµÙ„ÙŠ</h4><span id="statClass">3/3</span></div>

        <div class="stat-card"><h4>Ø§Ù„Ø·Ù„Ø§Ø¨</h4><span id="statCount">29</span></div>

        <div class="stat-card"><h4>Ø§Ù„ÙŠÙˆÙ…</h4><span>Ø§Ù„Ø£Ø­Ø¯</span></div>

    </div>

    

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">

        <button class="btn btn-info" onclick="showScreen('guidePage')">ğŸ“– Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… (ØµÙˆØ±)</button>

        <button id="adminBtn" class="btn hidden" style="background:var(--primary); color:white;" onclick="showScreen('adminPage')">ğŸ‘‘ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©</button>

    </div>



    <div id="passwordPanel" class="card" style="background: #f0fdf4; border: 1px solid #bbf7d0; padding: 20px; margin-bottom: 20px;">

        <h4 style="margin: 0 0 15px 0;">ğŸ” ØªØ£Ù…ÙŠÙ† Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±ÙˆØ±</h4>

        <div style="display:flex; gap:12px;">

            <input type="password" id="selfPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" style="margin:0;">

            <button class="btn btn-tech" style="width:auto; margin:0;" onclick="updateSelfPass()">ØªØ­Ø¯ÙŠØ«</button>

        </div>

    </div>



    <div id="filterPanel" class="card" style="background:#f1f2f6; border:none; padding:20px;">

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">

            <select id="viewWeek" onchange="renderNamesGrid()"></select>

            <select id="viewDay" onchange="renderNamesGrid()">

                <option>ÙŠÙˆÙ… Ø§Ù„Ø£Ø­Ø¯</option><option>ÙŠÙˆÙ… Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option><option>ÙŠÙˆÙ… Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option><option>ÙŠÙˆÙ… Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option><option>ÙŠÙˆÙ… Ø§Ù„Ø®Ù…ÙŠØ³</option>

            </select>

        </div>

        <input type="text" id="searchBox" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ Ø·Ø§Ù„Ø¨ (Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯) Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ø³Ø¬Ù„Ù‡ ÙˆØªØ¹Ø¯ÙŠÙ„Ù‡..." oninput="renderNamesGrid()">

    </div>



    <div id="broadcastPanel" class="card" style="background:#fff9e6; border:1px solid #ffeaa7;">

        <h4 style="margin: 0 0 10px 0;">ğŸ“¢ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¹Ù…ÙŠÙ… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ÙØµÙ„</h4>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">

            <input type="number" id="bcPage" placeholder="Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø©">

            <button class="btn" style="background:var(--warning); color:white; margin:0;" onclick="applyBroadcast()">ØªØ¹Ù…ÙŠÙ… Ø§Ù„Ø±ØµØ¯ Ù„Ù„ÙƒÙ„</button>

        </div>

        <p style="font-size:11px; color:#777; margin-top:10px;">* Ø³ÙŠØªÙ… Ø±ØµØ¯ "Ù„Ù… ÙŠØ³Ù…Ø¹" Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø¨Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…ÙƒØªÙˆØ¨.</p>

    </div>



    <div id="classTabs" style="display:flex; gap:10px; margin:20px 0; flex-wrap: wrap;"></div>

    <div id="namesGrid" class="grid"></div>

</div>



<div id="gradeScreen" class="hidden card no-print">

    <button class="btn btn-back" onclick="showScreen('teacherDash')">Ø±Ø¬ÙˆØ¹</button>

    <h3 id="targetName" style="color:var(--success); margin-bottom:5px;"></h3>

    <p id="targetCodeDisplay" style="margin-top:0; font-weight:bold; color:var(--info);"></p>

    

    <div class="card" style="background:#fdfdfd; border:1px solid #eee;">

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">

            <select id="gWeek"></select>

            <select id="gDay">

                <option>ÙŠÙˆÙ… Ø§Ù„Ø£Ø­Ø¯</option><option>ÙŠÙˆÙ… Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option><option>ÙŠÙˆÙ… Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option><option>ÙŠÙˆÙ… Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option><option>ÙŠÙˆÙ… Ø§Ù„Ø®Ù…ÙŠØ³</option>

            </select>

        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">

            <input type="number" id="gPage" placeholder="Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø©">

            <input type="number" id="gMark" placeholder="Ø§Ù„Ø¯Ø±Ø¬Ø© Ù…Ù† 7">

        </div>

        <select id="gStatus">

            <option value="Ø­Ø§ÙØ¸">Ø­Ø§ÙØ¸ âœ…</option>

            <option value="ØºÙŠØ± Ø­Ø§ÙØ¸">ØºÙŠØ± Ø­Ø§ÙØ¸ âš ï¸</option>

            <option value="Ù„Ù… ÙŠØ³Ù…Ø¹">Ù„Ù… ÙŠØ³Ù…Ø¹ âŒ</option>

            <option value="Ù…Ø­Ø±ÙˆÙ…">Ù…Ø­Ø±ÙˆÙ… ğŸš«</option>

            <option value="ØºØ§Ø¦Ø¨">ØºØ§Ø¦Ø¨ ğŸ’¤</option>

        </select>

        <textarea id="gNote" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù„Ù„Ù…Ø¹Ù„Ù… Ø£Ùˆ Ù„ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± Ù‡Ù†Ø§..." rows="3"></textarea>

        <label style="background:#fff1f1; padding:15px; border-radius:15px; display:block; cursor:pointer; border:1px solid #ffcccc;">

            <input type="checkbox" id="gCall"> Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ÙˆÙ„ÙŠ Ø£Ù…Ø± Ø±Ø³Ù…ÙŠ (Ø³ÙŠØ¸Ù‡Ø± Ù„Ù„Ø·Ø§Ù„Ø¨ Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø±) ğŸš©

        </label>

        <button class="btn btn-tech" onclick="saveGrade()">ğŸ’¾ Ø­ÙØ¸ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ±Ø§Ù‹</button>

    </div>



    <h4 style="border-right: 5px solid var(--info); padding-right: 15px;">ğŸ“œ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨:</h4>

    <div id="fullHistoryList"></div>

</div>



<div id="adminPage" class="hidden card no-print">

    <button class="btn btn-back" onclick="showScreen('teacherDash')">Ø±Ø¬ÙˆØ¹</button>

    <h2 style="text-align:center;">ğŸ¢ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h2>

    

    <div class="card" style="border: 2px solid var(--primary);">

        <h4>ğŸ”„ Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ (Ù†Ù‚Ù„ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø£ÙƒÙˆØ§Ø¯)</h4>

        <select id="adminStudentSelect" onchange="loadAdminFields()"></select>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">

            <input type="text" id="adminNewCode" placeholder="ØªØ¹Ø¯ÙŠÙ„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨">

            <select id="adminNewClass">

                <option>3/1</option><option>3/2</option><option>3/3</option><option>3/4</option><option>3/5</option>

            </select>

        </div>

        <button class="btn btn-tech" onclick="adminProcessUpdate()">ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</button>

    </div>



    <div class="card">

        <h4>ğŸ“‘ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©</h4>

        <button class="btn btn-info" onclick="generateReport()">ğŸ“¥ Ù…Ø¹Ø§ÙŠÙ†Ø© ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØµÙ„ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©</button>

        <button class="btn" style="background:#000; color:white;" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙƒØ´Ù Ø§Ù„Ø­Ø§Ù„ÙŠ</button>

    </div>



    <div id="secretStaffPanel" class="card" style="background:#f4f4f4;">

        <h4 style="color:var(--danger)">ğŸ”‘ ÙƒØ´Ù ÙƒÙ„Ù…Ø§Øª Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† (Ø³Ø±ÙŠ Ø¬Ø¯Ø§Ù‹)</h4>

        <div id="staffAuditList"></div>

    </div>

</div>



<div id="studentPage" class="hidden card no-print">

    <button class="btn btn-back" onclick="logout()">Ø®Ø±ÙˆØ¬</button>

    <h2 id="stdNameTitle"></h2>

    <div class="stats-box">

        <div class="stat-card" style="background:#e8f5e9;"><h4>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</h4><span>Ù…Ù…ØªØ§Ø²</span></div>

        <div class="stat-card" style="background:#fff9e6;"><h4>Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h4><span id="stdAlertCount">0</span></div>

        <div class="stat-card" style="background:#e3f2fd;"><h4>Ø§Ù„ÙØµÙ„</h4><span id="stdClassInfo"></span></div>

    </div>

    <div id="stdParentAlert"></div>

    <h3 style="margin-top:30px;">ğŸ“‰ Ø³Ø¬Ù„Ùƒ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ù…ÙØµÙ„:</h3>

    <div id="stdHistoryContainer"></div>

</div>



<div id="guidePage" class="hidden card no-print">

    <button class="btn btn-back" onclick="showScreen('teacherDash')">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¯Ù„ÙŠÙ„</button>

    <h2 style="text-align:center;">ğŸ“– Ø¯Ù„ÙŠÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©</h2>

    

    <div class="guide-step">

        <h4>1ï¸âƒ£ ÙƒÙŠÙÙŠØ© Ø±ØµØ¯ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</h4>

        <p>Ù…Ù† Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨. Ø³ØªØ¸Ù‡Ø± Ù„Ùƒ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ ÙˆÙƒÙˆØ¯Ù‡ Ø¨Ø¬Ø§Ù†Ø¨Ù‡. Ù‚Ù… Ø¨ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØµÙØ­Ø© ÙˆØ§Ù„ÙŠÙˆÙ…ØŒ Ø«Ù… Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø© (Ø­Ø§ÙØ¸ØŒ ØºØ§Ø¦Ø¨.. Ø¥Ù„Ø®). Ù„Ø§Ø­Ø¸ Ø£Ù† Ø§Ù„Ù„ÙˆÙ† Ø³ÙŠØªØºÙŠØ± ÙÙˆØ±Ø§Ù‹ ÙÙŠ Ù„ÙˆØ­ØªÙƒ Ù„ØªØ¹Ø±Ù Ù…Ù† Ù‚Ù…Øª Ø¨Ø±ØµØ¯Ù‡ ÙˆÙ…Ù† ØªØ¨Ù‚Ù‰.</p>

        <img src="https://i.ibb.co/YyYxR5v/teacher-guide-1.png" class="guide-img" alt="Step 1">

    </div>



    <div class="guide-step">

        <h4>2ï¸âƒ£ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ÙˆØ§Ù„Ø­Ø°Ù</h4>

        <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª. Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ø·Ø§Ù„Ø¨ØŒ Ø§Ù†Ø²Ù„ Ù„Ø£Ø³ÙÙ„ Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø³Ø¬Ù„. ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø£ÙŠ Ø±ØµØ¯ Ù‚Ø¯ÙŠÙ… Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„Ù‡. Ø¥Ø°Ø§ ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©ØŒ Ø³ÙŠØ¸Ù‡Ø± ØªÙ†Ø¨ÙŠÙ‡ "Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©" Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø´ÙØ§ÙÙŠØ©.</p>

    </div>



    <div class="guide-step">

        <h4>3ï¸âƒ£ ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ (ØµÙˆØ± ØªÙˆØ¶ÙŠØ­ÙŠØ©)</h4>

        <p>Ù‡Ø°Ø§ Ù…Ø§ ÙŠØ±Ø§Ù‡ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨ÙƒÙˆØ¯Ù‡ Ø§Ù„Ø®Ø§Øµ. ÙŠØ¸Ù‡Ø± Ù„Ù‡ ØªÙ†Ø¨ÙŠÙ‡ Ø£Ø­Ù…Ø± ÙƒØ¨ÙŠØ± ÙÙŠ Ø­Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù„ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±ØŒ Ù…Ø¹ ÙƒØ´Ù ÙƒØ§Ù…Ù„ Ø¨Ù…ØªØ£Ø®Ø±Ø§ØªÙ‡.</p>

        <img src="https://i.ibb.co/vXvC3m8/student-view.png" class="guide-img" alt="Student View">

    </div>



    <div class="guide-step">

        <h4>4ï¸âƒ£ Ø®ØµÙˆØµÙŠØ© Ø§Ù„Ø£Ù„ÙˆØ§Ù†</h4>

        <p>Ù…ÙŠØ²Ø© Ø§Ù„ØªÙ„ÙˆÙŠÙ† (Ø£Ø®Ø¶Ø±ØŒ Ø£ØµÙØ±ØŒ Ø£Ø­Ù…Ø±) Ù‡ÙŠ Ù…ÙŠØ²Ø© "Ø¬Ù„Ø³Ø©" (Session) Ù„Ù„Ù…Ø¹Ù„Ù… ÙÙ‚Ø·. Ø¨Ù…Ø¬Ø±Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŒ ØªØ¹ÙˆØ¯ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø·Ø¨ÙŠØ¹ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø£Ù† Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù‚Ø§Ø¯Ù… Ø£Ùˆ Ø£ÙŠ Ø´Ø®Øµ ÙŠØ±Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø§ ÙŠØ¹Ø±Ù Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø¥Ù„Ø§ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø±Ø³Ù…ÙŠ.</p>

    </div>

</div>

</div><div id="printSection" class="print-only"><h1 style="text-align:center;">Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¥Ù…Ø§Ù… ÙˆØ±Ø´ - ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠ</h1>

<div id="printContent"></div>

</div><footer><b>Ù†Ø¸Ø§Ù… Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¥Ù…Ø§Ù… ÙˆØ±Ø´ Ø§Ù„Ø°ÙƒÙŠ Â© 2026</b><br>

Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© | ØªØ·ÙˆÙŠØ±: Ù…ØµØ·ÙÙ‰ & ÙŠØ²Ù†<br>

<small>Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© v3.0 - ØªØ´ØºÙŠÙ„ Ù…Ø³ØªÙ‚Ø±</small>

</footer><script>
  
/* -----------------------------------------------------------
  
   Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© ÙˆØ§Ù„ØªØ­ÙƒÙ… (JavaScript Logic)
  
   ----------------------------------------------------------- */
  

  
// 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
  
const firebaseConfig = { 
  
    apiKey: "AIzaSyAC9BzBpw66oBDriZoi9A5zsThKLFZiNv8", 
  
    databaseURL: "https://imam-warsh-default-rtdb.asia-southeast1.firebasedatabase.app" 
  
};
  
firebase.initializeApp(firebaseConfig);
  
const db = firebase.database();
  

  
// 2. Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ÙˆÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  
let students = [], currentUser = null, targetSID = null, selectedClass = "3/3";
  
let sessionColors = {}; // Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø¨ÙˆÙƒØ³Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  

  
const initialData = [
  
    {name: "Ø§Ø­Ù…Ø¯ Ø¹Ù…Ø± Ø§Ù„Ø´Ù†Ù‚ÙŠØ·ÙŠ", code: "3326", class: "3/3"},
  
    {name: "Ø¨Ø³Ø§Ù… Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ù„Ø¬Ù‡Ù†ÙŠ", code: "3370", class: "3/3"},
  
    {name: "Ø¨Ø´Ø§Ø± Ø±Ø§Ù…Ø² ÙƒÙ†Ø¹Ø§Ù†", code: "3355", class: "3/3"},
  
    {name: "ØªÙ…ÙŠÙ… Ù†ÙˆØ± Ø§Ù„Ø¬Ù‡Ù†ÙŠ", code: "3309", class: "3/3"},
  
    {name: "Ø­Ø³ÙŠÙ† Ø¹Ø¨Ø¯Ø§Ù„ÙƒØ±ÙŠÙ… Ø¨Ù† Ø¨Ø§Ø¯ÙŠ Ø§Ù„Ø´Ù†Ù‚ÙŠØ·ÙŠ", code: "3358", class: "3/3"},
  
    {name: "Ø®Ø§Ù„Ø¯ Ø³Ù„ÙŠÙ… Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù†Ù‚ÙŠØ·ÙŠ", code: "3393", class: "3/3"},
  
    {name: "Ø±Ø§Ø¦Ø¯ ÙØ§ÙŠØ² Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø­Ø±Ø¨ÙŠ", code: "3301", class: "3/3"},
  
    {name: "Ø±ÙŠØ§Ù† Ø¹Ø·Ø§Ù„Ù„Ù‡ Ø¹Ø¨ÙŠØ§Ù† Ø§Ù„Ø¬Ù‡Ù†ÙŠ", code: "3389", class: "3/3"},
  
    {name: "Ø³Ø§Ù…Ø± Ø¹Ù…Ø± Ø¨Ù† Ø¯Ø®ÙŠÙ„ Ø§Ù„Ù„Ù‡ Ø§Ù„ØµØ§Ø¹Ø¯ÙŠ", code: "3259", class: "3/3"},
  
    {name: "Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ù„Ø¬Ù‡Ù†ÙŠ", code: "3302", class: "3/3"},
  
    {name: "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ø¨Ø¯Ù„ÙŠ", code: "3357", class: "3/3"},
  
    {name: "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø£Ù…ÙŠÙ† Ø­Ø¨ÙŠØ¨ Ø§Ù„Ù…Ø¨Ø§Ø±ÙƒÙŠ", code: "3392", class: "3/3"},
  
    {name: "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø¤Ù…Ù† Ø§Ù„Ø³ÙŠØ¯ Ø§Ù„Ø´Ù‡ÙŠØ¯", code: "3379", class: "3/3"},
  
    {name: "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù†Ø§ÙŠØ± Ø¹Ø¨Ø¯Ø§Ù„Ø¬Ù†ÙŠ", code: "3304", class: "3/3"},
  
    {name: "Ø¹Ù…Ø§Ø± Ø£Ø­Ù…Ø¯ Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¬Ù‡Ù†ÙŠ", code: "3399", class: "3/3"},
  
    {name: "Ø¹Ù…Ø± Ù…Ø­Ù…Ø¯ Ø§Ù„Ø£Ù…ÙŠÙ† â€“ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¨Ø´ÙŠØ±", code: "3310", class: "3/3"},
  
    {name: "ØºØ§Ù†Ù… ØµÙ„Ø§Ø­ ØºØ§Ù†Ù… Ø§Ù„Ø¬Ù‡Ù†ÙŠ", code: "3391", class: "3/3"},
  
    {name: "ÙØ±Ø§Ø³ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø¨Ù† Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ù„Ø¬Ù‡Ù†ÙŠ", code: "3322", class: "3/3"},
  
    {name: "ÙÙ‡Ø¯ Ù…Ø­Ù…Ø¯ ÙˆØµÙ„ Ø§Ù„Ø²Ø±ÙØ§Ù†ÙŠ", code: "3300", class: "3/3"},
  
    {name: "ÙÙŠØµÙ„ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ù…Ø§Ø·Ø± Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ", code: "3366", class: "3/3"},
  
    {name: "ÙÙŠØµÙ„ Ø­Ø³Ø§Ù… Ø§Ù„Ø¯ÙŠÙ† â€“ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯ÙŠÙ†", code: "3300", class: "3/3"},
  
    {name: "Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù†Ù‚ÙŠØ·ÙŠ", code: "3349", class: "3/3"},
  
    {name: "Ù…Ø®ØªØ§Ø± Ø­Ù…ÙˆØ¯ ÙˆØ£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯Ø³Ø¹Ø¯ ÙˆØ§Ù„Ù…Ø­Ù…Ø¯ Ø§Ù„Ù…Ø®ØªØ§Ø±", code: "3359", class: "3/3"},
  
    {name: "Ù…Ø®ØªØ§Ø± Ø±Ø¨ÙŠØ¹ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ ÙˆÙ„Ø¯ Ø§Ø¨Ø§Ù‡", code: "3365", class: "3/3"},
  
    {name: "Ù…ØµØ·ÙÙ‰ Ù…Ø®ØªØ§Ø± Ø¨Ù† Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø®ØªØ§Ø±", code: "3396", class: "3/3"},
  
    {name: "Ù…Ø¤ÙŠØ¯ Ø¹Ø¨Ø¯Ø§Ù„Ù‚ÙˆÙŠÙ… Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ù„Ù‡Ù†Ø¯ÙŠ", code: "3389", class: "3/3"},
  
    {name: "Ù†ÙˆØ§Ù Ø¹Ù…Ø± Ø¨Ù† Ø­Ù…Ø¯ Ø§Ù„Ø­Ø±Ø¨ÙŠ", code: "3395", class: "3/3"},
  
    {name: "Ù‡Ø§Ø´Ù… Ø£Ø­Ù…Ø¯ Ø¨Ù† ØµØ§Ù„Ø­ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡", code: "3388", class: "3/3"},
  
    {name: "ÙŠØ­ÙŠÙ‰ Ø£Ø­Ù…Ø¯ Ø²ÙŠÙ† ÙˆÙ„Ø¯ Ù…Ø­Ù…Ø¯ ÙˆÙ„Ø¯ Ù…Ø®ØªØ§Ø±", code: "3344", class: "3/3"}
  
];
  

  
// 3. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… (Initialization)
  
function init() {
  
    const weeksArr = Array.from({length: 35}, (_, i) => `Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ ${i + 1}`);
  
    const weekHTML = weeksArr.map(w => `<option value="${w}">${w}</option>`).join('');
  
    document.getElementById('viewWeek').innerHTML = weekHTML;
  
    document.getElementById('gWeek').innerHTML = weekHTML;
  

  
    // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ù…Ù† Firebase
  
    db.ref('students').on('value', snap => {
  
        if(!snap.val()) {
  
            initialData.forEach(s => db.ref('students').push(s));
  
        } else {
  
            students = Object.entries(snap.val()).map(([id, v]) => ({...v, id}));
  
            renderNamesGrid();
  
            renderAdminStudentSelect();
  
        }
  
    });
  

  
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
  
    db.ref('staff/saad').update({user: "saad", pass: "saad2026", role: "teacher", classes: "Ø§Ù„ÙƒÙ„"});
  
    db.ref('staff/ibrahim').update({user: "ibrahim", pass: "ibrahim2026", role: "teacher", classes: "3/3"});
  
    db.ref('staff/admin_').update({user: "admin_", pass: "admin2026", role: "admin", classes: "Ø§Ù„ÙƒÙ„"});
  

  
    // Ù…Ø±Ø§Ù‚Ø¨Ø© ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©
  
    db.ref('staff').on('value', snap => {
  
        const staff = snap.val() || {};
  
        let html = "<table><tr><th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯</th></tr>";
  
        Object.values(staff).forEach(s => {
  
            html += `<tr><td>${s.user}</td><td><b>${s.pass}</b></td></tr>`;
  
        });
  
        document.getElementById('staffAuditList').innerHTML = html + "</table>";
  
    });
  
}
  

  
// 4. ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„ØªØ¨Ø¯ÙŠÙ„
  
function toggleStaff() {
  
    document.getElementById('staffSection').classList.toggle('hidden');
  
}
  

  
async function mainAuth() {
  
    const key = document.getElementById('entryKey').value.trim();
  
    const pass = document.getElementById('entryPass').value.trim();
  
    const isStaff = !document.getElementById('staffSection').classList.contains('hidden');
  

  
    if(isStaff) {
  
        // ÙØ­Øµ Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙƒØ§Ø¯Ø±
  
        db.ref('staff/'+key).once('value', s => {
  
            const u = s.val();
  
            if(u && u.pass === pass) { 
  
                currentUser = u; 
  
                setupTeacherDash(); 
  
            } else { 
  
                alert("âŒ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©"); 
  
            }
  
        });
  
    } else {
  
        // ÙØ­Øµ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨
  
        const std = students.find(s => s.code === key);
  
        if(std) { 
  
            setupStudentPage(std); 
  
        } else { 
  
            alert("âŒ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); 
  
        }
  
    }
  
}
  

  
function setupTeacherDash() {
  
    showScreen('teacherDash');
  
    document.getElementById('roleDisplay').innerText = `Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${currentUser.user} | Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: ${currentUser.role}`;
  
    if(currentUser.role === 'admin') document.getElementById('adminBtn').classList.remove('hidden');
  
    renderClassTabs();
  
}
  

  
function renderClassTabs() {
  
    const cls = ["3/1", "3/2", "3/3", "3/4", "3/5"];
  
    let html = "";
  
    cls.forEach(c => {
  
        if(currentUser.classes === "Ø§Ù„ÙƒÙ„" || currentUser.classes.includes(c)) {
  
            html += `<button class="btn" style="width:auto; background:${selectedClass===c?'var(--success)':'#eee'}; color:${selectedClass===c?'white':'#000'}" onclick="changeClass('${c}')">${c}</button>`;
  
        }
  
    });
  
    document.getElementById('classTabs').innerHTML = html;
  
}
  

  
function changeClass(c) {
  
    selectedClass = c;
  
    document.getElementById('statClass').innerText = c;
  
    renderClassTabs();
  
    renderNamesGrid();
  
}
  

  
// 5. Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ØµØ¯ ÙˆØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø¨ÙˆÙƒØ³Ø§Øª
  
function renderNamesGrid() {
  
    const grid = document.getElementById('namesGrid');
  
    grid.innerHTML = "";
  
    const search = document.getElementById('searchBox').value.toLowerCase();
  
    const vW = document.getElementById('viewWeek').value;
  
    const vD = document.getElementById('viewDay').value;
  

  
    const filtered = students.filter(s => s.class === selectedClass && (s.name.toLowerCase().includes(search) || s.code.includes(search)));
  

  
    filtered.forEach(s => {
  
        const item = document.createElement('div');
  
        item.className = 'grid-item';
  
        
  
        // Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ø±ØµØ¯ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…
  
        const rec = (s.records || []).find(r => r.week === vW && r.day === vD);
  
        
  
        // Ø§Ù„ØªÙ„ÙˆÙŠÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  
        if(sessionColors[s.id]) {
  
            item.classList.add('status-' + sessionColors[s.id].replace(" ", "-"));
  
        } else if(rec) {
  
            item.classList.add('status-' + rec.status.replace(" ", "-"));
  
        }
  

  
        item.innerHTML = `
  
            <div style="font-size:16px;">${s.name}</div>
  
            <div style="font-size:12px; color:var(--info); font-weight:bold;">#${s.code}</div>
  
            <div style="margin-top:10px; font-size:13px;">${rec ? 'ğŸ“– ØµÙ€ '+rec.page : '---'}</div>
  
        `;
  
        item.onclick = () => openGradeWindow(s);
  
        grid.appendChild(item);
  
    });
  
    document.getElementById('statCount').innerText = filtered.length;
  
}
  

  
function openGradeWindow(s) {
  
    targetSID = s.id;
  
    document.getElementById('targetName').innerText = "Ø±ØµØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨: " + s.name;
  
    document.getElementById('targetCodeDisplay').innerText = "ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨: " + s.code;
  
    
  
    // ØªØµÙÙŠØ± Ø§Ù„Ø­Ù‚ÙˆÙ„
  
    document.getElementById('gPage').value = "";
  
    document.getElementById('gMark').value = "";
  
    document.getElementById('gNote').value = "";
  
    document.getElementById('gCall').checked = false;
  

  
    renderFullHistory(s);
  
    showScreen('gradeScreen');
  
}
  

  
function saveGrade() {
  
    const s = students.find(x => x.id === targetSID);
  
    if(!s.records) s.records = [];
  

  
    const data = {
  
        week: document.getElementById('gWeek').value,
  
        day: document.getElementById('gDay').value,
  
        page: document.getElementById('gPage').value,
  
        mark: document.getElementById('gMark').value,
  
        status: document.getElementById('gStatus').value,
  
        note: document.getElementById('gNote').value,
  
        isParentCall: document.getElementById('gCall').checked,
  
        timestamp: new Date().toISOString()
  
    };
  

  
    const idx = s.records.findIndex(r => r.week === data.week && r.day === data.day);
  
    if(idx > -1) {
  
        // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Ù„Ù„Ø´ÙØ§ÙÙŠØ©)
  
        if(!s.records[idx].originalStatus) s.records[idx].originalStatus = s.records[idx].status;
  
        s.records[idx] = {...s.records[idx], ...data};
  
    } else {
  
        s.records.push(data);
  
    }
  

  
    // ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø¨ÙˆÙƒØ³ ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙ‚Ø·
  
    sessionColors[s.id] = data.status;
  

  
    db.ref('students/'+s.id+'/records').set(s.records).then(() => {
  
        alert("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªÙ„ÙˆÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­");
  
        renderNamesGrid();
  
        showScreen('teacherDash');
  
    });
  
}
  

  
function applyBroadcast() {
  
    const p = document.getElementById('bcPage').value;
  
    if(!p) return alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø© Ø£ÙˆÙ„Ø§Ù‹");
  
    
  
    const vW = document.getElementById('viewWeek').value;
  
    const vD = document.getElementById('viewDay').value;
  

  
    students.filter(s => s.class === selectedClass).forEach(s => {
  
        if(!s.records) s.records = [];
  
        const idx = s.records.findIndex(r => r.week === vW && r.day === vD);
  
        if(idx === -1) {
  
            s.records.push({week: vW, day: vD, page: p, status: "Ù„Ù… ÙŠØ³Ù…Ø¹", mark: 0});
  
            db.ref('students/'+s.id+'/records').set(s.records);
  
        }
  
    });
  
    alert("ğŸ“¢ ØªÙ… ØªØ¹Ù…ÙŠÙ… Ø§Ù„Ø±ØµØ¯ (Ù„Ù… ÙŠØ³Ù…Ø¹) Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø§Ø¨ Ø§Ù„ÙØµÙ„");
  
}
  

  
function renderFullHistory(s) {
  
    const list = document.getElementById('fullHistoryList');
  
    list.innerHTML = (s.records || []).slice().reverse().map((r, i) => `
  
        <div class="history-item">
  
            <div style="display:flex; justify-content:space-between;">
  
                <strong>ğŸ“… ${r.week} - ${r.day}</strong>
  
                <span style="color:var(--info)">${r.status}</span>
  
            </div>
  
            <div style="margin-top:5px;">Ø§Ù„ØµÙØ­Ø©: ${r.page} | Ø§Ù„Ø¯Ø±Ø¬Ø©: ${r.mark}/7</div>
  
            ${r.note ? `<div style="font-size:12px; color:#666;">ğŸ“ ${r.note}</div>` : ''}
  
            ${r.originalStatus ? `<div class="original-badge">Ø§Ù„Ø­Ø§Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ${r.originalStatus}</div>` : ''}
  
            <div style="margin-top:10px;">
  
                <button onclick="deleteRow('${s.id}', ${s.records.length - 1 - i})" style="color:var(--danger); border:none; background:none; cursor:pointer; font-size:11px;">ğŸ—‘ï¸ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„</button>
  
            </div>
  
        </div>
  
    `).join('');
  
}
  

  
function deleteRow(sid, idx) {
  
    if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø±Ø¬Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
  
        const s = students.find(x => x.id === sid);
  
        s.records.splice(idx, 1);
  
        db.ref('students/'+sid+'/records').set(s.records).then(() => renderFullHistory(s));
  
    }
  
}
  

  
// 6. Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
  
function renderAdminStudentSelect() {
  
    const sel = document.getElementById('adminStudentSelect');
  
    sel.innerHTML = students.map(s => `<option value="${s.id}">${s.name} (ÙØµÙ„ ${s.class})</option>`).join('');
  
}
  

  
function loadAdminFields() {
  
    const s = students.find(x => x.id === document.getElementById('adminStudentSelect').value);
  
    document.getElementById('adminNewCode').value = s.code;
  
    document.getElementById('adminNewClass').value = s.class;
  
}
  

  
function adminProcessUpdate() {
  
    const sid = document.getElementById('adminStudentSelect').value;
  
    const c = document.getElementById('adminNewCode').value;
  
    const cl = document.getElementById('adminNewClass').value;
  
    
  
    db.ref('students/'+sid).update({code: c, class: cl}).then(() => alert("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­"));
  
}
  

  
function updateSelfPass() {
  
    const p = document.getElementById('selfPass').value;
  
    if(p.length < 4) return alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹");
  
    db.ref('staff/'+currentUser.user+'/pass').set(p).then(() => alert("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±Ùƒ Ø¨Ù†Ø¬Ø§Ø­"));
  
}
  

  
// 7. ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
  
function setupStudentPage(s) {
  
    showScreen('studentPage');
  
    document.getElementById('stdNameTitle').innerText = "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ " + s.name;
  
    document.getElementById('stdClassInfo').innerText = s.class;
  
    
  
    const calls = (s.records || []).filter(r => r.isParentCall);
  
    document.getElementById('stdAlertCount').innerText = calls.length;
  
    
  
    if(calls.length > 0) {
  
        document.getElementById('stdParentAlert').innerHTML = `
  
            <div class="card" style="background:#fff5f5; border:2px dashed var(--danger); color:var(--danger);">
  
                <h4>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ÙˆÙ„ÙŠ Ø£Ù…Ø±!</h4>
  
                <p>Ù„Ø¯ÙŠÙƒ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø±Ø³Ù…ÙŠ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„Ù… Ø¨Ø³Ø¨Ø¨: ${calls[calls.length-1].note || 'Ø§Ù„Ø­ÙØ¸ Ø£Ùˆ Ø§Ù„Ø³Ù„ÙˆÙƒ'}</p>
  
            </div>
  
        `;
  
    } else {
  
        document.getElementById('stdParentAlert').innerHTML = "";
  
    }
  

  
    document.getElementById('stdHistoryContainer').innerHTML = (s.records || []).slice().reverse().map(r => `
  
        <div class="card" style="padding:15px; border-right:10px solid ${r.status==='Ø­Ø§ÙØ¸'?'var(--success)':'var(--danger)'}">
  
            <strong>${r.week} - ${r.day}</strong> <br>
  
            Ø§Ù„Ø­Ø§Ù„Ø©: ${r.status} | ØµÙØ­Ø©: ${r.page} | Ø§Ù„Ø¯Ø±Ø¬Ø©: ${r.mark}
  
        </div>
  
    `).join('');
  
}
  

  
// 8. Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø©
  
function showScreen(id) {
  
    document.querySelectorAll('#app > div, #loginGate').forEach(d => d.classList.add('hidden'));
  
    document.getElementById('app').classList.remove('hidden');
  
    document.getElementById(id).classList.remove('hidden');
  
    window.scrollTo(0,0);
  
}
  

  
function logout() {
  
    sessionColors = {}; // Ù…Ø³Ø­ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙƒÙ…Ø§ Ø·Ù„Ø¨ Ù…ØµØ·ÙÙ‰
  
    location.reload();
  
}
  

  
function generateReport() {
  
    const content = document.getElementById('printContent');
  
    let html = `<h3>ÙƒØ´Ù Ø¯Ø±Ø¬Ø§Øª ÙØµÙ„: ${selectedClass}</h3><table border="1" style="width:100%; border-collapse:collapse;"><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„ÙƒÙˆØ¯</th><th>Ø¢Ø®Ø± ØµÙØ­Ø©</th></tr>`;
  
    
  
    students.filter(s => s.class === selectedClass).forEach(s => {
  
        const last = (s.records || []).pop();
  
        html += `<tr><td>${s.name}</td><td>${s.code}</td><td>${last?last.page:'---'}</td></tr>`;
  
    });
  
    content.innerHTML = html + "</table>";
  
    alert("Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¬Ø§Ù‡Ø²ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¶ØºØ· Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©");
  
}
  

  
// ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…
  
init();
  
</script></body></html>
